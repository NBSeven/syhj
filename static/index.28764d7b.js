import{Q as e,_ as t,a,M as r,k as o,m as u,N as l,S as i,b as d,g as s,f as p,w as n,x as c,e as m,r as h,o as q,y,t as f,j as b}from"./index.233133c1.js";import{_ as g}from"./lodash.4765e2cd.js";import{u as w}from"./productList.ad0a3efb.js";const I={TRAuditMKT:{path:"/trAudit/index",query:{trCheckType:1}},TRAuditR_D:{path:"/trAudit/index",query:{trCheckType:2}},StructBomAudit:{path:"/bomView/struc",query:{}},StructBomImport:{path:"/structuralMaterialImport/index",query:{}},ElectronicBomImport:{path:"/electronicImport/index",query:{}},ElectronicBomAudit:{path:"/bomView/elec",query:{}},StructPriceInput:{path:"/resourcesDepartment/construction",query:{}},ElecBomPriceAudit:{path:"/bomVerify/electronic",query:{}},StructBomPriceAudit:{path:"/bomVerify/construction",query:{}},ElectronicPriceInput:{path:"/resourcesDepartment/electronic",query:{}},BomPriceAudit:{path:"/bomVerify/index",query:{}},ElecLossRateInput:{path:"/bomLoss/indexElec",query:{}},StructLossRateInput:{path:"/bomLoss/indexStruct",query:{}},ManHourImport:{path:"/processImport/index",query:{}},LogisticsCostInput:{path:"/pmDepartment/index",query:{}},NreInputOther:{path:"/nre/nreProjectManageMent",query:{}},NreInputEmc:{path:"/nre/nrePilotprojects",query:{}},NreInputMould:{path:"/nre/nreResourcesDepartment",query:{}},NreInputTest:{path:"/nre/nreExperimentItems",query:{}},NreInputGage:{path:"/nre/nreQCDepartment",query:{}},TradeApproval:{path:"/tradeCompliance/index",query:{}},PriceBoardAudit:{path:"/dashboard",query:{}},PriceCheckDownload:{path:"/quoteAnalysis/index",query:{}},CostCheckNreFactor:{path:"/quoteAnalysis/index",query:{}},QuoteApproval:{path:"/marketingQuotation/index",query:{}},QuoteFormCheckDownload:"/marketingQuotation/index",ArchiveEnd:{path:"/archive/index",query:{}},LossRateInput:{path:"/processImport/index",query:{}},RequirementInput:{path:"/demandApply/index",query:{}},PMInput:{path:"/partEntry/managerOperate",query:{}},ProductionCostInput:{path:"/manufacturingCost/index",query:{}}};const V={class:"todo-center"},j=y("新建"),N=y("跳转"),_=y("跳转");var x=t(a({__name:"index",setup(t){const a=w(),x=r(),P=o({quoteProjectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],quoteProjectNumber:[{required:!0,message:"请输入项目代码",trigger:"blur"}],quoteVersion:[{required:!0,message:"等待后端返回版本号继续",trigger:"blur"}]}),v=b(),D=r("upcoming"),A=o({quoteProjectName:"",quoteProjectNumber:"",quoteVersion:"",remarks:""});let F=r([]),k=r([]),R=r(!1);const C=async t=>{if(t){if(!A.quoteVersion&&A.quoteProjectName){let t=await(a=A.quoteProjectName,e({url:"/api/services/app/VersionManagment/GetAuditFlowNewVersionByProjectName",method:"get",data:{projectName:a}}));A.quoteVersion=t.result.newVersion,t.result.projectNumber&&(A.quoteProjectNumber=t.result.projectNumber)}var a;await t.validate((async(e,t)=>{e&&v.push({path:"/demandApply/index",query:{projectName:A.quoteProjectName,projectCode:A.quoteProjectNumber,quoteVersion:A.quoteVersion}})}))}},L=(e,t)=>{a.setProductList(t.row.auditFlowId);let r=I[e.processIdentifier],o=Object.assign({auditFlowId:t.row.auditFlowId,right:e.right},r.query);window.sessionStorage.getItem("productId")&&(o.productId=window.sessionStorage.getItem("productId")),v.push({path:`${r.path}`,query:o})};return u((()=>{window.sessionStorage.getItem("productId")&&window.sessionStorage.removeItem("productId")})),l((async()=>{var t,a;let r=await e({url:"/api/services/app/AuditFlow/GetAllAuditFlowInfos",method:"get"});if(r.result){let e=[];F.value=g.cloneDeep(r.result),F.value.forEach(((t,a)=>{t.auditFlowRightDetailList=t.auditFlowRightDetailList.filter((e=>2===e.right)),0===t.auditFlowRightDetailList.length&&e.push(a)})),e.sort(((e,t)=>t-e)),e.forEach((e=>{F.value.splice(e,1)}));let t=[];k.value=g.cloneDeep(r.result),k.value.forEach(((e,a)=>{e.auditFlowRightDetailList=e.auditFlowRightDetailList.filter((e=>1===e.right)),0===e.auditFlowRightDetailList.length&&t.push(a)})),t.sort(((e,t)=>t-e)),t.forEach((e=>{k.value.splice(e,1)}))}try{let e=window.localStorage.getItem("user"),r=e?JSON.parse(e):{};((null==(a=null==(t=null==r?void 0:r.userRole)?void 0:t.items)?void 0:a.map((e=>e.name)))||[]).includes("营销部-业务员")&&(R.value=!0)}catch(o){}})),i((()=>{})),(e,t)=>{const a=h("el-input"),r=h("el-form-item"),o=h("el-form"),u=h("el-button"),l=h("el-card"),i=h("el-table-column"),b=h("el-table"),g=h("el-tab-pane"),w=h("el-tabs");return q(),d("div",V,[s(R)?(q(),p(l,{key:0,class:"card"},{default:n((()=>[m(o,{model:A,inline:"",rules:P,ref_key:"projectFormRef",ref:x},{default:n((()=>[m(r,{label:"项目名称",prop:"quoteProjectName"},{default:n((()=>[m(a,{modelValue:A.quoteProjectName,"onUpdate:modelValue":t[0]||(t[0]=e=>A.quoteProjectName=e)},null,8,["modelValue"])])),_:1}),m(r,{label:"项目代码",prop:"quoteProjectNumber"},{default:n((()=>[m(a,{modelValue:A.quoteProjectNumber,"onUpdate:modelValue":t[1]||(t[1]=e=>A.quoteProjectNumber=e)},null,8,["modelValue"])])),_:1}),m(r,{label:"版本号",prop:"quoteVersion"},{default:n((()=>[m(a,{modelValue:A.quoteVersion,"onUpdate:modelValue":t[2]||(t[2]=e=>A.quoteVersion=e),disabled:""},null,8,["modelValue"])])),_:1}),m(r,{label:"备注",prop:"remarks"},{default:n((()=>[m(a,{modelValue:A.remarks,"onUpdate:modelValue":t[3]||(t[3]=e=>A.remarks=e),type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),m(u,{onClick:t[4]||(t[4]=e=>C(x.value)),type:"primary"},{default:n((()=>[j])),_:1})])),_:1})):c("",!0),m(l,{class:"card"},{default:n((()=>[m(w,{modelValue:D.value,"onUpdate:modelValue":t[5]||(t[5]=e=>D.value=e),type:"card"},{default:n((()=>[m(g,{label:"待办",name:"upcoming"},{default:n((()=>[m(b,{data:s(F),"default-expand-all":""},{default:n((()=>[m(i,{type:"expand"},{default:n((e=>[m(b,{data:e.row.auditFlowRightDetailList},{default:n((()=>[m(i,{label:"流程界面",prop:"processName"}),m(i,{label:"是否回退"},{default:n((e=>[y(f(e.row.isRetype?"是":"否"),1)])),_:1}),m(i,{label:"流转说明",prop:"jumpDescription"}),m(i,{label:"跳转至流程"},{default:n((t=>[m(u,{onClick:a=>L(t.row,e)},{default:n((()=>[N])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["data"])])),_:1}),m(i,{label:"流程ID",prop:"auditFlowId"}),m(i,{label:"流程标题",prop:"auditFlowTitle"})])),_:1},8,["data"])])),_:1}),m(g,{label:"已办/查看",name:"check"},{default:n((()=>[m(b,{data:s(k),"default-expand-all":""},{default:n((()=>[m(i,{type:"expand"},{default:n((e=>[m(b,{data:e.row.auditFlowRightDetailList},{default:n((()=>[m(i,{label:"流程界面",prop:"processName"}),m(i,{label:"是否回退"},{default:n((e=>[y(f(e.row.isRetype?"是":"否"),1)])),_:1}),m(i,{label:"流转说明",prop:"jumpDescription"}),m(i,{label:"跳转至流程"},{default:n((t=>[m(u,{onClick:a=>L(t.row,e)},{default:n((()=>[_])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["data"])])),_:1}),m(i,{label:"流程ID",prop:"auditFlowId"}),m(i,{label:"流程标题",prop:"auditFlowTitle"})])),_:1},8,["data"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])}}}),[["__scopeId","data-v-5a75b3a1"]]);export{x as default};
