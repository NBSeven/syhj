import{Q as e,_ as l,a,k as o,m as t,N as i,S as s,W as r,b as d,i as n,e as u,w as m,r as p,o as c,F as b,n as f,f as g,y as _,E as y,Z as h}from"./index.c6c04119.js";const w={class:"role"},V={class:"role__btn-container"},k=_("搜索"),F={class:"role__btn-container"},v=_("创建角色"),C=_("编辑"),x=_("删除"),P={class:"role__btn-container"},z={class:"dialog-footer"},L=_("取消"),R=_("保存");var U=l(a({__name:"index",setup(l,{expose:a}){const _=o({tableData:[],dialogVisible:!1,formLabelWidth:"140px",searchForm:{keyword:""},pageSize:20,pageNo:1,total:0,roleForm:{id:null,name:"",description:"",grantedPermissions:[]},permissionList:[],isEdit:!1}),U=async()=>{let l=null;l=_.isEdit?await function(l){return e({url:"/api/services/app/Role/Update",method:"put",data:l})}(_.roleForm):await function(l){return e({url:"/api/services/app/Role/Create",method:"post",data:l})}(_.roleForm),l.success&&(y({type:"success",message:"保存成功"}),_.dialogVisible=!1,W())},N=()=>{_.roleForm={id:null,name:"",description:"",grantedPermissions:[]}},E=(l,a)=>{h.confirm("确定删除该角色?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{if("number"==typeof a.id){(await(l=a.id,e({url:"/api/services/app/Role/Delete",method:"delete",data:{id:l}}))).success&&(y({type:"success",message:"删除成功"}),W())}var l}))},S=async()=>{let l={keyword:"",maxResultCount:20,skipCount:0};l.keyword=_.searchForm.keyword,l.skipCount=(_.pageNo-1)*_.pageSize,l.maxResultCount=_.pageSize;let a=await function(l){return e({url:"/api/services/app/Role/GetAll",method:"get",data:l})}(l);_.tableData=a.result.items,_.total=a.result.totalCount},W=()=>{S()},D=()=>{S()},A=()=>{_.dialogVisible=!0,_.isEdit=!1};return t((()=>{})),i((async()=>{let l=await e({url:"/api/services/app/Role/GetAllPermissions",method:"get"});_.permissionList=l.result.items,W()})),s((()=>{})),a({...r(_)}),(e,l)=>{const a=p("el-input"),o=p("el-form-item"),t=p("el-button"),i=p("el-form"),s=p("el-table-column"),r=p("el-table"),y=p("el-pagination"),h=p("el-option"),S=p("el-select"),B=p("el-dialog");return c(),d("div",w,[n("div",V,[u(i,{model:_.searchForm,inline:""},{default:m((()=>[u(o,{label:"关键字"},{default:m((()=>[u(a,{modelValue:_.searchForm.keyword,"onUpdate:modelValue":l[0]||(l[0]=e=>_.searchForm.keyword=e)},null,8,["modelValue"])])),_:1}),u(o,null,{default:m((()=>[u(t,{type:"primary",onClick:W},{default:m((()=>[k])),_:1})])),_:1})])),_:1},8,["model"])]),n("div",F,[u(t,{type:"primary",onClick:A},{default:m((()=>[v])),_:1})]),u(r,{data:_.tableData,style:{width:"100%"}},{default:m((()=>[u(s,{label:"id",prop:"id"}),u(s,{label:"角色名称",prop:"name"}),u(s,{label:"角色描述",prop:"description"}),u(s,{label:"角色权限",prop:"grantedPermissions"}),u(s,{label:"操作"},{default:m((e=>[u(t,{size:"small",onClick:l=>{return e.$index,a=e.row,_.isEdit=!0,_.roleForm=a,void(_.dialogVisible=!0);var a}},{default:m((()=>[C])),_:2},1032,["onClick"]),u(t,{size:"small",type:"danger",onClick:l=>E(e.$index,e.row)},{default:m((()=>[x])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),n("div",P,[u(y,{background:"",layout:"prev, pager, next",total:_.total,"page-size":_.pageSize,currentPage:_.pageNo,"onUpdate:currentPage":[l[1]||(l[1]=e=>_.pageNo=e),D]},null,8,["total","page-size","currentPage"])]),u(B,{modelValue:_.dialogVisible,"onUpdate:modelValue":l[6]||(l[6]=e=>_.dialogVisible=e),title:"角色信息",onClose:N},{footer:m((()=>[n("span",z,[u(t,{onClick:l[5]||(l[5]=e=>_.dialogVisible=!1)},{default:m((()=>[L])),_:1}),u(t,{type:"primary",onClick:U},{default:m((()=>[R])),_:1})])])),default:m((()=>[u(i,{model:_.roleForm},{default:m((()=>[u(o,{label:"角色名称","label-width":_.formLabelWidth},{default:m((()=>[u(a,{modelValue:_.roleForm.name,"onUpdate:modelValue":l[2]||(l[2]=e=>_.roleForm.name=e),autocomplete:"off"},null,8,["modelValue"])])),_:1},8,["label-width"]),u(o,{label:"角色描述","label-width":_.formLabelWidth},{default:m((()=>[u(a,{modelValue:_.roleForm.description,"onUpdate:modelValue":l[3]||(l[3]=e=>_.roleForm.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1},8,["label-width"]),u(o,{label:"权限选择","label-width":_.formLabelWidth},{default:m((()=>[u(S,{modelValue:_.roleForm.grantedPermissions,"onUpdate:modelValue":l[4]||(l[4]=e=>_.roleForm.grantedPermissions=e),multiple:""},{default:m((()=>[(c(!0),d(b,null,f(_.permissionList,(e=>(c(),g(h,{value:e.name,key:e.name,label:e.displayName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-87816292"]]);export{U as default};
