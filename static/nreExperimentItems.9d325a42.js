import{g as e}from"./nreQCDepartmentSummaries.660b71b7.js";import{g as a,h as l,c as t}from"./request.9bb9f23d.js";import{g as o}from"./getQuery.bab2d130.js";import{_ as d,a as r,M as u,k as s,m as i,N as n,S as m,b as p,e as c,w as V,i as f,I as h,f as w,E as y,r as b,o as _,g,y as x,t as U,a2 as I,X as P}from"./index.9c83b174.js";import{a as v,h as k}from"./upload.6ede2a33.js";const N={style:{padding:"0 10px"}},j=x(" 试验项目（根据与客户协定项目） "),C=x("NRE实验费表单上传"),E=x("NRE实验费模板下载"),T=x("新增"),D=x("删除"),q={style:{float:"right",margin:"20px 0"}},z=x("提交");var F=d(r({__name:"nreExperimentItems",setup(d){const{auditFlowId:r,productId:F}=o(),R=u([]),S=s({experimentItems:[]}),Q=()=>{S.experimentItems.push({allCost:0,count:0,dataDV:"",dataPV:"",dataThoroughly:"",isThirdParty:!1,projectName:"",remark:"",unit:"",unitPrice:0})},M=async()=>{try{const{success:e}=await a({auditFlowId:r,experimentItems:{productId:F,qaTestDepartments:S.experimentItems.map((e=>({...e,allCost:(e.unitPrice||0)*(e.count||0)})))}});if(!e)throw Error();y.success("提交成功")}catch(e){}},X=async()=>{try{const e=await t({FileName:""});I(e,"NRE实验费模板")}catch(e){}},$=async e=>{S.experimentItems=e.result||[],y.success("上传成功！")},A=(e,a)=>{};return i((()=>{})),n((()=>{(async()=>{const{result:e}=await l(r,F);S.experimentItems=(null==e?void 0:e.qaTestDepartments)||[]})()})),m((()=>{})),(a,l)=>{const t=b("el-button"),o=b("el-upload"),d=b("el-row"),r=b("el-table-column"),u=b("el-input"),s=b("el-option"),i=b("el-select"),n=b("el-input-number"),m=b("el-date-picker"),y=b("el-table"),I=b("el-card"),F=P("havedone");return _(),p("div",N,[c(I,{class:"margin-top"},{header:V((()=>[c(d,{style:{width:"100%"},justify:"space-between",align:"middle"},{default:V((()=>[j,c(d,null,{default:V((()=>[c(o,{"file-list":R.value,"onUpdate:file-list":l[0]||(l[0]=e=>R.value=e),"show-file-list":!1,action:"/api/services/app/NrePricing/PostExperimentItemsSingleExcel","on-success":$,"on-change":A,name:"fileName","on-progress":g(v),"on-error":g(k)},{default:V((()=>[c(t,{style:{"margin-top":"8px"}},{default:V((()=>[C])),_:1})])),_:1},8,["file-list","on-progress","on-error"]),c(t,{type:"primary",onClick:X,m:"2"},{default:V((()=>[E])),_:1}),h((_(),w(t,{type:"primary",onClick:Q,m:"2"},{default:V((()=>[T])),_:1})),[[F]])])),_:1})])),_:1})])),default:V((()=>[c(y,{data:S.experimentItems,style:{width:"100%"},border:"","summary-method":g(e),"show-summary":""},{default:V((()=>[c(r,{type:"index",width:"50"}),c(r,{label:"试验项目（根据与客户协定项目）",width:"180"},{default:V((({row:e})=>[c(u,{modelValue:e.projectName,"onUpdate:modelValue":a=>e.projectName=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"是否指定第三方",width:"180"},{default:V((({row:e})=>[c(i,{modelValue:e.isThirdParty,"onUpdate:modelValue":a=>e.isThirdParty=a},{default:V((()=>[c(s,{value:!0,label:"是"}),c(s,{value:!1,label:"否"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"单价",width:"180"},{default:V((({row:e})=>[c(u,{modelValue:e.unitPrice,"onUpdate:modelValue":a=>e.unitPrice=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"数量",width:"180"},{default:V((({row:e})=>[c(n,{modelValue:e.count,"onUpdate:modelValue":a=>e.count=a,"controls-position":"right",min:0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"总费用",width:"180"},{default:V((({row:e})=>[x(U(e.unitPrice*e.count),1)])),_:1}),c(r,{label:"时间-摸底",width:"250"},{default:V((({row:e})=>[c(m,{modelValue:e.dataThoroughly,"onUpdate:modelValue":a=>e.dataThoroughly=a,type:"date",size:"small"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"时间-DV",width:"250"},{default:V((({row:e})=>[c(m,{modelValue:e.dataDV,"onUpdate:modelValue":a=>e.dataDV=a,type:"date",size:"small"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"时间-PV",width:"250"},{default:V((({row:e})=>[c(m,{modelValue:e.dataPV,"onUpdate:modelValue":a=>e.dataPV=a,type:"date",size:"small"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"单位",width:"180"},{default:V((({row:e})=>[c(u,{modelValue:e.unit,"onUpdate:modelValue":a=>e.unit=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"备注",width:"180"},{default:V((({row:e})=>[c(u,{modelValue:e.remark,"onUpdate:modelValue":a=>e.remark=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(r,{label:"操作",fixed:"right",width:"85px"},{default:V((({$index:e})=>[h((_(),w(t,{onClick:a=>{return l=e,void S.experimentItems.splice(l,1);var l},type:"danger"},{default:V((()=>[D])),_:2},1032,["onClick"])),[[F]])])),_:1})])),_:1},8,["data","summary-method"])])),_:1}),f("div",q,[h((_(),w(t,{type:"primary",onClick:M},{default:V((()=>[z])),_:1})),[[F]])])])}}}),[["__scopeId","data-v-a30e5434"]]);export{F as default};
