import{Q as e,_ as a,a as t,M as l,k as o,m as r,N as i,P as n,E as u,r as s,X as d,o as p,b as c,e as m,w as h,F as f,n as y,f as b,y as g,t as v,g as w,x as C,i as I,a3 as _,I as P,a1 as k,Z as x,z as E,A as V,h as M}from"./index.c6c04119.js";import{g as D}from"./getQuery.b59b1282.js";import{d as F,i as T}from"./index.5afe4c12.js";import{u as A}from"./useJump.ddac3685.js";import{a as O,h as S}from"./upload.8b094582.js";function B(e){const a=["","",""],t=Math.abs(e);return t>=1e3?(a[0]=`${Math.floor(t/1e3)} `,a[1]="K"):(a[0]=t+"",a[1]=""),e<0?"-"+a.join(""):a.join("")}const L={title:{text:"产品成本",subtext:"",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left",show:!1},label:{alignTo:"edge",formatter:e=>`${e.seriesName}: ${B(e.value||0)}`,minMargin:5,edgeDistance:10,lineHeight:15,rich:{time:{fontSize:10,color:"#999"}}},series:[{name:"产品成本",type:"pie",radius:"50%",data:[{value:0,name:"bom成本"},{value:0,name:"损耗成本"},{value:0,name:"制造成本"},{value:0,name:"物流成本"},{value:0,name:"质量成本"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},N={title:{text:"产品成本利润分布图 - 客户目标价",subtext:"",left:"center"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",splitLine:{show:!1},data:["bom成本","损耗成本","制造成本","物流成本","质量成本","利润"]},yAxis:{type:"value"},series:[{type:"bar",showBackground:!0,stack:"Total",label:{show:!0,position:"top",formatter:e=>B(e.value||0)},backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},data:[0,0,0,0,0,0]}]},U={xAxis:{type:"category",data:["2021","2022","2023","2024","2025","2026","2027"]},yAxis:{type:"value"},series:[{data:[],type:"line",label:{show:!0,position:"top",formatter:e=>Math.floor(e.value||0).toLocaleString("en-US")},smooth:!0}]},G=[{title:"BOM成本",value:"1"},{title:"损耗成本",value:"2"},{title:"制造成本",value:"3"},{title:"物流成本",value:"4"},{title:"质量成本",value:"5"}];function q(a,t,l,o){return e({url:"/api/services/app/PriceBoardCheck/SetPriceBoardState",method:"post",data:{auditFlowId:a,isAgree:t,backProcessIdentifiers:o,opinionDescription:l}})}const j=e=>(E("data-v-1c7e0973"),e=e(),V(),e),Y={class:"dashboard"},z=g(" 产品核价表 "),Q=g("NRE核价表"),R=g(" 生成核价表 "),K=j((()=>I("div",{class:"dashboard__footer"},[I("div",{id:"percentageCostChart"})],-1))),X=j((()=>I("div",{class:"dashboard__body"},[I("div",{id:"costChart"})],-1))),$=g("TR方案上传"),H=j((()=>I("div",{id:"selectCostChart"},null,-1))),J={style:{float:"right",margin:"20px 0"}},Z=g("同意"),W=g("退回"),ee=g("产品开发部-结构BOM录入"),ae=g("产品开发部-EMC实验费录入"),te=g("产品开发部-电子BOM录入"),le=g("品质保证部-检具费录入"),oe=g("品质保证部-实验费录入"),re=g("项目管理部-NRE费用录入"),ie=g("工程技术部-电子损耗率录入"),ne=g("工程技术部-结构损耗率录入"),ue=g("工程技术部-工序工时录入"),se=g("生产管理部-物流成本录入"),de=g("资源管理课-模具单价录入"),pe=g("资源管理课-结构单价录入"),ce=g("资源管理课-电子单价录入"),me=j((()=>I("div",{style:{margin:"10px 0"}},"拒绝理由：",-1))),he=g("取消"),fe=g("确定"),ye=g("取消"),be=g("设置投入量和年份"),ge=g("生成核价表");var ve=a(t({__name:"index",setup(a){const{jumpTodoCenter:t}=A(),{auditFlowId:E,productId:V}=D();let M=null,B=null,j=null,ve=l(!1),we=l([]),Ce=l("");const Ie=l([]),_e=o({year:"",mode:"1",yearsOptions:[],bomData:[],lossData:[],manufactureData:[],logisticsData:[],qualityData:[],productInputs:0,createVisible:!1,priceEvaluationTableInputCount:[]}),Pe=async a=>{let t=await function(a,t){return e({url:"/api/services/app/PriceEvaluation/AddPricingPanelTrProgrammeId",method:"post",data:{auditFlowId:a,fileManagementId:t}})}(E,a.result.fileId);t.success},ke=(e,a)=>{},xe=(e,a)=>{let t=document.getElementById(e);if(t){var l=T(t);return l.setOption(a),l}};r((()=>{})),i((()=>{if(!E)return!1;Ee(),Me()}));const Ee=async()=>{if(await Ve(),await De(),!V)return!1;await Ye(),await qe()};n((()=>{null==M||M.dispose(),null==j||j.dispose(),null==B||B.dispose()}));const Ve=()=>{M=xe("costChart",N),B=xe("percentageCostChart",L),j=xe("selectCostChart",U),window.onresize=function(){B.resize(),j.resize(),M.resize()}},Me=async()=>{const{result:{items:a=[]}}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetPriceEvaluationTableInputCount",method:"get",data:{auditFlowId:a}})}(E);_e.priceEvaluationTableInputCount=a},De=async()=>{await Fe()},Fe=async()=>{var a;try{const t=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetPricingPanelTimeSelectList",method:"get",data:a})}({AuditFlowId:E});_e.yearsOptions=null==(a=null==t?void 0:t.result)?void 0:a.items,_e.year=_e.yearsOptions[0].id,_e.year,_e.yearsOptions[0].id}catch(t){}},Te=async()=>{try{_e.year;const{result:a}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetBomCost",method:"get",data:a})}({Year:_e.year,AuditFlowId:E,ModelCountId:V});_e.bomData=a||[]}catch(a){}},Ae=async()=>{try{const{result:a}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetLossCost",method:"get",data:a})}({Year:_e.year,AuditFlowId:E,ModelCountId:V});_e.lossData=a||[]}catch(a){}},Oe=async()=>{try{const{result:a}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetQualityCost",method:"get",data:a})}({Year:_e.year,AuditFlowId:E,ModelCountId:V});_e.qualityData=[a]}catch(a){}},Se=async()=>{k.push({path:"/nupriceManagement/productPriceList",query:{auditFlowId:E,productId:V,year:_e.year}})},Be=async()=>{k.push({path:"/nre/nrePricelist",query:{year:_e.year,auditFlowId:E,productId:V,hideBtn:1}})},Le=async()=>{try{const{result:a}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetLogisticsCost",method:"get",data:a})}({Year:_e.year,AuditFlowId:E,ModelCountId:V});_e.logisticsData=a}catch(a){}},Ne=async()=>{try{const{result:a}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetManufacturingCost",method:"get",data:a})}({Year:_e.year,AuditFlowId:E,ModelCountId:V});_e.manufactureData=a}catch(a){}},Ue=async()=>{try{const{result:a}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetPricingPanelProportionOfProductCost",method:"get",data:a})}({Year:_e.year,AuditFlowId:E,ModelCountId:V}),t=null==a?void 0:a.items.map((e=>{var a;return{value:(null==(a=e.proportion)?void 0:a.toFixed(2))||0,name:e.name}}));B.setOption({...L,series:L.series.map(((e,a)=>({...L.series[a],data:t})))})}catch(a){}},Ge=async()=>{var a;try{const{result:t}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetPricingPanelProfit",method:"get",data:a})}({Year:_e.year,AuditFlowId:E,ModelCountId:V}),l=null==(a=null==t?void 0:t.items)?void 0:a.map((e=>Math.floor(e.proportion)));M.setOption({...N,series:N.series.map(((e,a)=>({...N.series[a],data:l})))}),t.items}catch(t){}},qe=async()=>{const{result:{items:a=[]}}=await function(a){return e({url:"/api/services/app/PriceEvaluation/GetGoTable",method:"get",data:a})}({AuditFlowId:E,ModelCountId:V,InputCount:_e.productInputs}),t=a.map((e=>Math.floor(e.value)))||[],l=a.map((e=>e.year))||[];j=xe("selectCostChart",{...U,xAxis:{...U.xAxis,data:[...l]},series:U.series.map(((e,a)=>({...U.series[a],data:t})))})},je=async e=>{x.confirm("确定执行该操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{let a;e?a=await q(E,e,Ce.value):Ce.value?a=await q(E,e,Ce.value,we.value):u({type:"warning",message:"拒绝理由必填"}),a.success&&(t(),u({type:"success",message:"操作成功"}))}))},Ye=async()=>{_e.year,Ue(),Ge(),ze()},ze=()=>{switch(_e.mode){case"1":Te();break;case"2":Ae();break;case"3":Ne();break;case"4":Le();break;case"5":Oe()}},Qe=F((async()=>{await function(a){return e({url:"/api/services/app/PriceEvaluation/CreatePriceEvaluationTable",method:"post",data:{auditFlowId:a}})}(E),u.success("生成成功！")}),500),Re=F((async()=>{await function(a){return e({url:"/api/services/app/PriceEvaluation/SetPriceEvaluationTableInputCount",method:"post",data:a})}({auditFlowId:E,modelCountInputCount:_e.priceEvaluationTableInputCount.map((e=>({...e,modelCountId:e.id})))}),u.success("设置成功！"),Me()}),500);return(e,a)=>{const t=s("el-option"),l=s("el-select"),o=s("el-button"),r=s("el-row"),i=s("el-radio"),n=s("el-radio-group"),u=s("el-card"),k=s("el-table-column"),x=s("el-table"),E=s("el-col"),V=s("el-upload"),M=s("el-checkbox"),D=s("el-checkbox-group"),F=s("el-input"),T=s("el-dialog"),A=s("el-input-number"),B=d("havedone");return p(),c("div",Y,[m(u,{class:"m-2"},{default:h((()=>[m(r,{align:"middle"},{default:h((()=>[m(l,{modelValue:_e.year,"onUpdate:modelValue":a[0]||(a[0]=e=>_e.year=e),class:"m-2",placeholder:"请选择年份",onChange:Ye},{default:h((()=>[(p(!0),c(f,null,y(_e.yearsOptions,(e=>(p(),b(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),m(o,{type:"primary",class:"m-2",onClick:Se},{default:h((()=>[z])),_:1}),m(o,{type:"primary",class:"m-2",onClick:Be},{default:h((()=>[Q])),_:1}),m(o,{type:"primary",class:"m-2",onClick:a[1]||(a[1]=e=>_e.createVisible=!0)},{default:h((()=>[R])),_:1})])),_:1}),m(r,{class:"m-2"},{default:h((()=>[m(n,{modelValue:_e.mode,"onUpdate:modelValue":a[2]||(a[2]=e=>_e.mode=e),onChange:ze},{default:h((()=>[(p(!0),c(f,null,y(w(G),(e=>(p(),b(i,{key:e.title,label:e.value,size:"large",border:""},{default:h((()=>[g(v(e.title),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),m(u,{class:"m-2"},{default:h((()=>[m(u,{header:"成本明细表"},{default:h((()=>["1"===_e.mode?(p(),b(x,{key:0,data:_e.bomData,border:"",height:"675"},{default:h((()=>[m(k,{prop:"superType",label:"超级大种类",width:"180"}),m(k,{prop:"materialName",label:"材料名称",width:"180"}),m(k,{prop:"typeName",label:"物料种类",width:"180"}),m(k,{prop:"categoryName",label:"物料大类",width:"150"}),m(k,{prop:"assemblyCount",label:"装配数量"}),m(k,{prop:"materialPrice",label:"材料单价（原币）",width:"180"}),m(k,{prop:"currencyText",label:"币别",width:"150"}),m(k,{prop:"exchangeRate",label:"汇率",width:"150"}),m(k,{prop:"materialPriceCyn",label:"材料单价（人民币）",width:"180"}),m(k,{prop:"totalMoneyCyn",label:"合计金额（人民币）",width:"180"}),m(k,{prop:"loss",label:"损耗",width:"150"}),m(k,{prop:"materialCost",label:"材料成本（含损耗）",width:"180"}),m(k,{prop:"inputCount",label:"投入量",width:"150"}),m(k,{prop:"purchaseCount",label:"采购量",width:"150"}),m(k,{prop:"moqShareCount",label:"MOQ分摊成本",width:"150"}),m(k,{prop:"moq",label:"MOQ"}),m(k,{prop:"availableInventory",label:"可用库存",width:"150"}),m(k,{prop:"remarks",label:"备注"})])),_:1},8,["data"])):C("",!0),"2"===_e.mode?(p(),b(x,{key:1,data:_e.lossData,height:"675"},{default:h((()=>[m(k,{prop:"name",label:"成本项目",width:"180"}),m(k,{prop:"wastageCost",label:"损耗成本",width:"180"}),m(k,{prop:"moqShareCount",label:"MOQ分摊成本",width:"180"})])),_:1},8,["data"])):C("",!0),"3"===_e.mode?(p(),b(x,{key:2,data:_e.manufactureData,border:"",height:"675"},{default:h((()=>[m(k,{prop:"gradientKy",label:"梯度K/Y",width:"180"}),m(k,{prop:"manufacturingCostDirect",label:"直接制造成本"},{default:h((()=>[m(k,{prop:"manufacturingCostDirect.directLabor",label:"直接人工",width:"150"}),m(k,{prop:"manufacturingCostDirect.equipmentDepreciation",label:"设备折旧",width:"150"}),m(k,{prop:"manufacturingCostDirect.lineChangeCost",label:"换线成本",width:"150"}),m(k,{prop:"manufacturingCostDirect.manufacturingExpenses",label:"制造费用",width:"150"}),m(k,{prop:"manufacturingCostDirect.subtotal",label:"小计",width:"150"})])),_:1}),m(k,{prop:"manufacturingCostIndirect",label:"间接制造成本"},{default:h((()=>[m(k,{prop:"manufacturingCostIndirect.directLabor",label:"直接人工",width:"150"}),m(k,{prop:"manufacturingCostIndirect.equipmentDepreciation",label:"设备折旧",width:"150"}),m(k,{prop:"manufacturingCostIndirect.manufacturingExpenses",label:"制造费用",width:"150"}),m(k,{prop:"manufacturingCostIndirect.subtotal",label:"小计",width:"150"})])),_:1})])),_:1},8,["data"])):C("",!0),"4"===_e.mode?(p(),b(x,{key:3,data:_e.logisticsData,border:"",height:"675"},{default:h((()=>[m(k,{prop:"year",label:"年份",width:"80"}),m(k,{prop:"freight",label:"运费/月",width:"180"}),m(k,{prop:"monthEndDemand",label:"月底需求量",width:"180"}),m(k,{prop:"storageExpenses",label:"仓储费用/元",width:"180"}),m(k,{prop:"perPackagingPrice",label:"单PCS包装价格/元",width:"150"}),m(k,{prop:"perFreight",label:"单PCS运输费",width:"150"}),m(k,{prop:"perTotalLogisticsCost",label:"单PCS总物流料成本",width:"180"})])),_:1},8,["data"])):C("",!0),"5"===_e.mode?(p(),b(x,{key:4,data:_e.qualityData,border:"",height:"675"},{default:h((()=>[m(k,{prop:"productCategory",label:"产品类别"}),m(k,{prop:"costProportion",label:"成本比例"}),m(k,{prop:"qualityCost",label:"质量成本（MAX）"})])),_:1},8,["data"])):C("",!0)])),_:1}),m(u,null,{default:h((()=>[m(r,null,{default:h((()=>[m(E,{span:12},{default:h((()=>[K])),_:1}),m(E,{span:12},{default:h((()=>[X])),_:1})])),_:1})])),_:1}),m(u,{style:{"margin-top":"10px"}},{default:h((()=>[m(V,{"file-list":Ie.value,"onUpdate:file-list":a[3]||(a[3]=e=>Ie.value=e),"show-file-list":!1,action:"/api/services/app/FileCommonService/UploadFile","on-success":Pe,"on-change":ke,style:{float:"right"},"on-progress":w(O),"on-error":w(S)},{default:h((()=>[m(o,{type:"primary"},{default:h((()=>[$])),_:1})])),_:1},8,["file-list","on-progress","on-error"]),H,I("div",J,[m(o,{type:"primary",onClick:a[4]||(a[4]=e=>je(!0))},{default:h((()=>[Z])),_:1}),m(o,{type:"primary",onClick:a[5]||(a[5]=e=>_(ve)?ve.value=!0:ve=!0)},{default:h((()=>[W])),_:1})])])),_:1})])),_:1}),m(T,{modelValue:w(ve),"onUpdate:modelValue":a[10]||(a[10]=e=>_(ve)?ve.value=e:ve=e),title:"退回选择"},{footer:h((()=>[I("span",null,[P((p(),b(o,{onClick:a[8]||(a[8]=e=>_(ve)?ve.value=!1:ve=!1)},{default:h((()=>[he])),_:1})),[[B]]),P((p(),b(o,{type:"primary",onClick:a[9]||(a[9]=e=>je(!1))},{default:h((()=>[fe])),_:1})),[[B]])])])),default:h((()=>[m(D,{modelValue:w(we),"onUpdate:modelValue":a[6]||(a[6]=e=>_(we)?we.value=e:we=e)},{default:h((()=>[m(M,{label:"StructBomImport"},{default:h((()=>[ee])),_:1}),m(M,{label:"NreInputEmc"},{default:h((()=>[ae])),_:1}),m(M,{label:"ElectronicBomImport"},{default:h((()=>[te])),_:1}),m(M,{label:"NreInputGage"},{default:h((()=>[le])),_:1}),m(M,{label:"NreInputTest"},{default:h((()=>[oe])),_:1}),m(M,{label:"NreInputOther"},{default:h((()=>[re])),_:1}),m(M,{label:"ElecLossRateInput"},{default:h((()=>[ie])),_:1}),m(M,{label:"StructLossRateInput"},{default:h((()=>[ne])),_:1}),m(M,{label:"ManHourImport"},{default:h((()=>[ue])),_:1}),m(M,{label:"LogisticsCostInput"},{default:h((()=>[se])),_:1}),m(M,{label:"NreInputMould"},{default:h((()=>[de])),_:1}),m(M,{label:"StructPriceInput"},{default:h((()=>[pe])),_:1}),m(M,{label:"ElectronicPriceInput"},{default:h((()=>[ce])),_:1})])),_:1},8,["modelValue"]),I("div",null,[me,m(F,{type:"textarea",modelValue:w(Ce),"onUpdate:modelValue":a[7]||(a[7]=e=>_(Ce)?Ce.value=e:Ce=e)},null,8,["modelValue"])])])),_:1},8,["modelValue"]),m(T,{modelValue:_e.createVisible,"onUpdate:modelValue":a[12]||(a[12]=e=>_e.createVisible=e),title:"生成核价表"},{footer:h((()=>[I("span",null,[m(o,{onClick:a[11]||(a[11]=e=>_e.createVisible=!1)},{default:h((()=>[ye])),_:1}),m(o,{onClick:w(Re),type:"primary"},{default:h((()=>[be])),_:1},8,["onClick"]),m(o,{onClick:w(Qe),type:"primary"},{default:h((()=>[ge])),_:1},8,["onClick"])])])),default:h((()=>[m(x,{data:_e.priceEvaluationTableInputCount},{default:h((()=>[m(k,{prop:"productName",label:"产品名称",width:"180"}),m(k,{prop:"year",label:"年份"},{default:h((({row:e})=>[m(l,{modelValue:e.year,"onUpdate:modelValue":a=>e.year=a,class:"m-2",placeholder:"请选择年份"},{default:h((()=>[(p(!0),c(f,null,y(_e.yearsOptions,(e=>(p(),b(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),m(k,{prop:"inputCount",label:"投入量",width:"180"},{default:h((({row:e})=>[m(A,{"controls-position":"right",modelValue:e.inputCount,"onUpdate:modelValue":a=>e.inputCount=a,placeholder:"请输入投入量"},null,8,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-1c7e0973"]]);const we=t({__name:"index",setup:e=>(e,a)=>(p(),b(M(ve)))});export{we as default};
