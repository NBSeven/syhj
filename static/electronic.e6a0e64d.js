import{a as e,v as a,M as l,k as r,m as t,N as o,S as n,b as i,I as s,f as u,w as d,r as p,X as y,o as m,e as c,F as w,n as b,x as v,R as f,t as h,y as k,E as g}from"./index.ad8f3002.js";import{G as C,P as V,a as _,b as E}from"./request.30eb8ff8.js";import{g as U}from"./service.014fdda6.js";import{g as Y}from"./getQuery.06af59d7.js";const x={class:"margin-top"},R=k(" % "),M={key:1},$={key:1},T={key:1},I={key:1},S={key:1},K=k("确认"),N=k(" 提交 "),q=k(" 修改 "),j=k("取消"),F=e({__name:"electronic",setup(e){const{auditFlowId:k=1,productId:F}=Y(),Q=a(),D=l(!1),G=l([]),L=r({materialsUseCountYears:[],systemiginalCurrencyYears:[],inTheRateYears:[],iginalCurrencyYears:[],standardMoneyYears:[]}),O=l([]);t((()=>{Q.userInfo})),o((()=>{G.value,P(),(async()=>{const e=await U({maxResultCount:100,skipCount:0});O.value=e.result.items||[]})()}));const P=async()=>{const{result:e}=await C(k,F);if(!e)return!1;const{materialsUseCount:a,systemiginalCurrency:l,inTheRate:r,iginalCurrency:t,standardMoney:o}=e[0]||{};L.materialsUseCountYears=(null==a?void 0:a.map((e=>e.year)))||[],L.systemiginalCurrencyYears=(null==l?void 0:l.map((e=>e.year)))||[],L.inTheRateYears=(null==r?void 0:r.map((e=>e.year)))||[],L.iginalCurrencyYears=(null==t?void 0:t.map((e=>e.year)))||[],L.standardMoneyYears=(null==o?void 0:o.map((e=>e.year)))||[],G.value=e},X=async(e,a)=>{try{const{success:l}=await V({isSubmit:a,electronicDtoList:[e],auditFlowId:k});if(!l)throw Error();g.success((a?"提交":"确认")+"成功"),a?e.isEntering=!0:e.isSubmit=!0,P()}catch(l){g.error("提交失败~")}},z=(e,a)=>{e.isEdit=a};return n((()=>{})),(e,a)=>{const l=p("el-table-column"),r=p("el-option"),t=p("el-select"),o=p("el-input"),n=p("el-input-number"),k=p("el-button"),C=p("el-table"),V=p("el-card"),U=y("havedone"),Y=y("loading");return m(),i("div",x,[s((m(),u(V,{class:"table-wrap",header:"电子料单价录入界面"},{default:d((()=>[c(C,{data:G.value,height:"75vh"},{default:d((()=>[c(l,{prop:"categoryName",label:"物料大类",width:"180",fixed:"left"}),c(l,{prop:"typeName",label:"物料种类",width:"180",fixed:"left"}),c(l,{prop:"sapItemNum",label:"物料编号",width:"180",fixed:"left"}),c(l,{prop:"sapItemName",label:"材料名称",width:"180",fixed:"left"}),c(l,{prop:"materialsUseCount",label:"项目物料的使用量"},{default:d((()=>[(m(!0),i(w,null,b(null==L?void 0:L.materialsUseCountYears,((e,a)=>(m(),u(l,{key:e,label:`${e}`,prop:`materialsUseCount[${a}].value`,width:"180"},null,8,["label","prop"])))),128))])),_:1}),c(l,{prop:"currency",label:"币种",width:"150"},{default:d((e=>[e.row.isEdit?(m(),u(t,{key:0,modelValue:e.row.currency,"onUpdate:modelValue":a=>e.row.currency=a,placeholder:"选择币种"},{default:d((()=>[(m(!0),i(w,null,b(O.value,(e=>(m(),u(r,{key:e.id,label:e.exchangeRateKind,value:e.exchangeRateKind},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):v("",!0)])),_:1}),c(l,{prop:"systemiginalCurrency",label:"系统单价（原币）"},{default:d((()=>[(m(!0),i(w,null,b(null==L?void 0:L.systemiginalCurrencyYears,((e,a)=>(m(),u(l,{key:e,label:`${e}`,prop:`systemiginalCurrency[${a}].value`,width:"180"},null,8,["label","prop"])))),128))])),_:1}),c(l,{prop:"inTheRate",label:"年降率"},{default:d((()=>[(m(!0),i(w,null,b(null==L?void 0:L.inTheRateYears,((e,a)=>(m(),u(l,{key:e,label:`${e}`,prop:`inTheRate[${a}].value`,width:"180"},{default:d((e=>{var l,r;return[e.row.isEdit?(m(),u(o,{key:0,modelValue:e.row.inTheRate[a].value,"onUpdate:modelValue":l=>e.row.inTheRate[a].value=l,onKeyup:f((a=>(async(e,a)=>{try{D.value=!0;const{success:l,result:r}=await _(e);if(!l&&!r.length)throw Error();G.value[a]={...r||{},isEdit:!0},D.value=!1}catch(l){g.error("计算失败~"),D.value=!1}})(e.row,e.$index)),["enter"])},{append:d((()=>[R])),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])):(m(),i("span",M,h(null==(r=null==(l=e.row)?void 0:l.inTheRate[a])?void 0:r.value),1))]})),_:2},1032,["label","prop"])))),128))])),_:1}),c(l,{prop:"iginalCurrency",label:"原币"},{default:d((()=>[(m(!0),i(w,null,b(null==L?void 0:L.iginalCurrencyYears,((e,a)=>(m(),u(l,{key:e,label:`${null==e?void 0:e.toString()}`,prop:`iginalCurrency[${a}].value`,width:"180"},{default:d((e=>[e.row.isEdit?(m(),u(n,{key:0,modelValue:e.row.iginalCurrency[a].value,"onUpdate:modelValue":l=>e.row.iginalCurrency[a].value=l,"controls-position":"right",min:0,onKeyup:f((a=>(async(e,a)=>{try{D.value=!0;const{success:l,result:r}=await E(e);if(!l&&!r.length)throw Error();G.value[a]={...r||{},isEdit:!0},D.value=!1}catch(l){D.value=!1,g.error("计算失败~")}})(e.row,e.$index)),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):v("",!0),e.row.isEdit?v("",!0):(m(),i("span",$,h(e.row.iginalCurrency[a].value),1))])),_:2},1032,["label","prop"])))),128))])),_:1}),c(l,{prop:"standardMoney",label:"本位币"},{default:d((()=>[(m(!0),i(w,null,b(null==L?void 0:L.standardMoneyYears,((e,a)=>(m(),u(l,{key:e,label:`${null==e?void 0:e.toString()}`,prop:`standardMoney[${a}].value`,width:"180"},null,8,["label","prop"])))),128))])),_:1}),c(l,{prop:"moq",label:"MOQ",width:"180"},{default:d((({row:e})=>[e.isEdit?(m(),u(n,{key:0,modelValue:e.moq,"onUpdate:modelValue":a=>e.moq=a,"controls-position":"right",min:0},null,8,["modelValue","onUpdate:modelValue"])):v("",!0),e.isEdit?v("",!0):(m(),i("span",T,h(e.moq),1))])),_:1}),c(l,{prop:"rebateMoney",label:"物料返利金额",width:"180"},{default:d((({row:e})=>[e.isEdit?(m(),u(n,{key:0,modelValue:e.rebateMoney,"onUpdate:modelValue":a=>e.rebateMoney=a,"controls-position":"right",min:0},null,8,["modelValue","onUpdate:modelValue"])):v("",!0),e.isEdit?v("",!0):(m(),i("span",I,h(e.rebateMoney),1))])),_:1}),c(l,{label:"备注"},{default:d((({row:e})=>[e.isEdit?(m(),u(o,{key:0,modelValue:e.remark,"onUpdate:modelValue":a=>e.remark=a},null,8,["modelValue","onUpdate:modelValue"])):v("",!0),e.isEdit?v("",!0):(m(),i("span",S,h(e.remark),1))])),_:1}),c(l,{prop:"peopleName",label:"确认人"}),c(l,{label:"操作",fixed:"right",width:"180"},{default:d((e=>[s((m(),u(k,{link:"",disabled:e.row.isSubmit,onClick:a=>X(e.row,0),type:"danger"},{default:d((()=>[K])),_:2},1032,["disabled","onClick"])),[[U]]),e.row.isEntering?s((m(),u(k,{key:0,link:"",disabled:e.row.isSubmit,onClick:a=>X(e.row,1),type:"warning"},{default:d((()=>[N])),_:2},1032,["disabled","onClick"])),[[U]]):v("",!0),e.row.isEdit?v("",!0):s((m(),u(k,{key:1,link:"",onClick:a=>z(e.row,!0),type:"primary"},{default:d((()=>[q])),_:2},1032,["onClick"])),[[U]]),e.row.isEdit?s((m(),u(k,{key:2,link:"",onClick:a=>z(e.row,!1)},{default:d((()=>[j])),_:2},1032,["onClick"])),[[U]]):v("",!0)])),_:1})])),_:1},8,["data"])])),_:1})),[[Y,D.value]])])}}});export{F as default};
