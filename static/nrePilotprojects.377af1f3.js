import{a as e,b as a,c as l}from"./request.bfe1b597.js";import{g as t}from"./getQuery.d371256b.js";import{_ as o,a as d,M as u,k as r,m as s,N as n,S as i,b as m,e as c,w as p,i as V,I as f,f as y,E as h,r as b,o as w,g as _,y as g,t as U,a2 as v,X as P}from"./index.ca893667.js";import{a as N,h as F}from"./upload.a976257a.js";const M=e=>{const{columns:a,data:l}=e,t=[];return a.forEach(((e,a)=>{if(4===a)return void(t[a]="实验费合计");const o=l.map((e=>Number((e.count||0)*(e.unitPrice||0))));o.every((e=>Number.isNaN(e)))||5!==a?t[a]="":t[a]=`¥ ${o.reduce(((e,a)=>Number.isNaN(a)?e:e+a),0)}`})),t};const k={style:{padding:"0 10px"}},x=g(" 实验费用 "),I=g("NRE实验费模板上传"),C=g("NRE实验费模板下载"),j=g("新增"),E=g("删除"),D={style:{float:"right",margin:"20px 0"}},T=g("提交");var R=o(d({__name:"nrePilotprojects",setup(o){const d=u([]);let{auditFlowId:R,productId:S}=t();const $=()=>{q.laboratoryFeeModels.push({unitPrice:0,allCost:0,count:0})},q=r({laboratoryFeeModels:[]}),B=async()=>{try{const{success:e}=await a({auditFlowId:R,productDepartmentModels:{productId:S,laboratoryFeeModels:q.laboratoryFeeModels.map((e=>({...e,allCost:(e.unitPrice||0)*(e.count||0)})))||[]}});e&&h.success("提交成功")}catch(e){}},Q=async()=>{try{const e=await l({FileName:""});v(e,"NRE实验费模板")}catch(e){}},X=async e=>{const{result:a}=e;q.laboratoryFeeModels=a||[],h.success("上传成功！")},z=(e,a)=>{};return s((()=>{})),n((()=>{(async()=>{const{result:a}=await e(R,S)||{};q.laboratoryFeeModels=a.laboratoryFeeModels||[]})()})),i((()=>{})),(e,a)=>{const l=b("el-button"),t=b("el-upload"),o=b("el-row"),u=b("el-table-column"),r=b("el-input"),s=b("el-option"),n=b("el-select"),i=b("el-input-number"),h=b("el-date-picker"),v=b("el-table"),R=b("el-card"),S=P("havedone");return w(),m("div",k,[c(R,{class:"card-warp"},{header:p((()=>[c(o,{style:{width:"100%"},justify:"space-between",align:"middle"},{default:p((()=>[x,c(o,null,{default:p((()=>[c(t,{"file-list":d.value,"onUpdate:file-list":a[0]||(a[0]=e=>d.value=e),"show-file-list":!1,action:"/api/services/app/NrePricing/PostProductDepartmentSingleExcel","on-success":X,"on-change":z,name:"fileName","on-progress":_(N),"on-error":_(F)},{default:p((()=>[c(l,{class:"uploadBtn"},{default:p((()=>[I])),_:1})])),_:1},8,["file-list","on-progress","on-error"]),c(l,{type:"primary",onClick:Q,m:"2"},{default:p((()=>[C])),_:1}),f((w(),y(l,{type:"primary",onClick:$,m:"2"},{default:p((()=>[j])),_:1})),[[S]])])),_:1})])),_:1})])),default:p((()=>[c(v,{data:q.laboratoryFeeModels,border:"","summary-method":_(M),"show-summary":"",height:"70vh"},{default:p((()=>[c(u,{type:"index",width:"50"}),c(u,{label:"试验项目（根据与客户协定项目）",width:"180"},{default:p((({row:e})=>[c(r,{modelValue:e.testItem,"onUpdate:modelValue":a=>e.testItem=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"是否指定第三方",width:"150"},{default:p((({row:e})=>[c(n,{modelValue:e.isThirdParty,"onUpdate:modelValue":a=>e.isThirdParty=a},{default:p((()=>[c(s,{value:!0,label:"是"}),c(s,{value:!1,label:"否"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"单价",width:"120"},{default:p((({row:e})=>[c(i,{modelValue:e.unitPrice,"onUpdate:modelValue":a=>e.unitPrice=a,min:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"数量",width:"120"},{default:p((({row:e})=>[c(i,{modelValue:e.count,"onUpdate:modelValue":a=>e.count=a,min:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"时间-摸底",width:"180"},{default:p((({row:e})=>[c(h,{modelValue:e.dataThoroughly,"onUpdate:modelValue":a=>e.dataThoroughly=a,type:"date"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"时间-DV",width:"180"},{default:p((({row:e})=>[c(h,{modelValue:e.dataDV,"onUpdate:modelValue":a=>e.dataDV=a,type:"date"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"时间-PV",width:"180"},{default:p((({row:e})=>[c(h,{modelValue:e.dataPV,"onUpdate:modelValue":a=>e.dataPV=a,type:"date"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"单位",width:"180"},{default:p((({row:e})=>[c(r,{modelValue:e.unit,"onUpdate:modelValue":a=>e.unit=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"总费用",width:"150"},{default:p((({row:e})=>[g(" ￥ "+U(e.unitPrice*e.count),1)])),_:1}),c(u,{label:"备注",width:"180"},{default:p((({row:e})=>[c(r,{modelValue:e.remark,"onUpdate:modelValue":a=>e.remark=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(u,{label:"操作",fixed:"right",width:"90"},{default:p((({$index:e})=>[f((w(),y(l,{onClick:a=>{return l=e,void q.laboratoryFeeModels.splice(l,1);var l},type:"danger"},{default:p((()=>[E])),_:2},1032,["onClick"])),[[S]])])),_:1})])),_:1},8,["data","summary-method"])])),_:1}),V("div",D,[f((w(),y(l,{type:"primary",onClick:B},{default:p((()=>[T])),_:1})),[[S]])])])}}}),[["__scopeId","data-v-149c6def"]]);export{R as default};
