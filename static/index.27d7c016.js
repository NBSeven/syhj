import{Q as e,_ as t,a,k as l,M as r,N as o,b as i,e as n,w as u,r as p,o as s,g as d,F as m,n as c,f as h,I as b,y as g,E as w,a1 as f,X as y,z as D,A as F,i as v}from"./index.91226b5a.js";import{g as P}from"./getQuery.336943ac.js";import{g as q}from"./service.cf08febf.js";import{C as _}from"./bom.417dda2d.js";import{a as k,h as H}from"./upload.e57b9fe1.js";const x=e=>(D("data-v-7cc0ff88"),e=e(),F(),e),$={class:"electronic-import"},I=x((()=>v("span",null,"工序工时导入",-1))),L=g("工序工时上传"),N=g("工序工时模版下载"),U=g("SOR下载"),C=g("3D爆炸图下载"),V=g("项目走量查看"),R=g("结构bom查看"),S=g("保存"),j=x((()=>v("span",null,"跟线/切线工时",-1))),W=g("UPH值:"),A=g("保存"),M=g("提交流程");var T=t(a({__name:"index",setup(t){const{auditFlowId:a,productId:g}=P(),D=l({tableData:[],downloadSetForm:{number:0},retrospectPart:{equipmentDetails:[]},toolingFixturePart:{equipmentDetails:[]},equipmentPart:{equipmentDetails:[]},humanMachineHoursDetailList:[],sop:[],uph:null,tangentForm:{tangent:[]},years:[],isSaved:!1,auditFlowId:null,fileName:"",picture3D:{fileName:"",id:""}}),F=r(),v=(e,t="equipmentDetails")=>Math.max.apply(null,D.tableData.map((a=>{var l,r;return t?(null==(l=a[e])?void 0:l.equipmentDetails.length)||0:(null==(r=a[e])?void 0:r.length)||0}))),x=e=>{var t,a;const{success:l,result:r}=e;l&&(null==(t=null==r?void 0:r.workingHourDetailList)?void 0:t.length)>0?(D.tableData=null==(a=e.result)?void 0:a.workingHourDetailList,T(),w.success("上传成功！")):w.error(r.message||"上传失败~")},T=()=>{var e;D.tableData,D.retrospectPart={equipmentDetails:new Array(v("retrospectPart"))},D.retrospectPart,D.toolingFixturePart={equipmentDetails:new Array(v("toolingFixturePart"))},D.equipmentPart={equipmentDetails:new Array(v("equipmentPart"))},D.humanMachineHoursDetailList=(null==(e=D.tableData[0])?void 0:e.humanMachineHoursDetailList)||[]},E=async()=>{const t=await e({url:"/api/services/app/FileCommonService/DownloadWorkingHoursInfo",method:"post",responseType:"blob"}),a=new FileReader;a.readAsDataURL(t),a.onload=function(){let e=URL.createObjectURL(new Blob([t])),a=document.createElement("a");document.body.appendChild(a),a.href=e,a.download="模板文件.xlsx",a.target="_blank",a.click(),a.remove()}},G=async()=>{if(await B(),!D.picture3D.id)return!1;const e=await _(D.picture3D.id),t=new FileReader;t.readAsDataURL(e),t.onload=function(){let t=URL.createObjectURL(new Blob([e])),a=document.createElement("a");document.body.appendChild(a),a.href=t,a.download=D.picture3D.fileName,a.target="_blank",a.click(),a.remove()}},B=async()=>{const{result:t}=await function(t){return e({url:"/api/services/app/WorkingHours/GetPicture3DByAuditFlowId",method:"get",data:{auditFlowId:t}})}(a);D.picture3D.fileName=t.sorFileName,D.picture3D.id=t.sorFileId},O=async()=>{if(!D.sorFileName)return!1;const e=await _(D.fileId),t=new FileReader;t.readAsDataURL(e),t.onload=function(){let t=URL.createObjectURL(new Blob([e])),a=document.createElement("a");document.body.appendChild(a),a.href=t,a.download=D.sorFileName,a.target="_blank",a.click(),a.remove()}},Q=()=>{f.push({path:"/resourcesDepartment/moduleNumber",query:{auditFlowId:a,productId:g}})},z=()=>{f.push({path:"/bomView/struc",query:{auditFlowId:a,productId:g,right:1}})},X=async()=>{try{let{success:t}=await function(t){return e({url:"/api/services/app/WorkingHours/SaveWorkingHour",method:"post",data:t})}({auditFlowId:Number(a),productId:g,workingHourDetailList:D.tableData});if(!t)throw Error();w.success("请求成功！")}catch{w.error("请求失败")}},Y=async t=>{await(null==t?void 0:t.validate((async t=>{t?(await function(t){return e({url:"/api/services/app/WorkingHours/SubmitWorkingHourAndSwitchLine",method:"post",data:{auditFlowId:t}})}(a),w.success("提交成功！")):w.error("请填写正确数据！")})))},J=async()=>{var t;const{result:l}=await function(t,a){return e({url:"/api/services/app/WorkingHours/GetWorkingHour",method:"get",data:{auditFlowId:t,productId:a}})}(a,g)||{};(null==(t=l.workingHourDetailList)?void 0:t.length)&&(D.tableData=l.workingHourDetailList,T())};o((async()=>{D.auditFlowId=a,(async()=>{const{result:e}=await q(a);D.sorFileName=e.sorFileName,D.fileId=e.sorFileId})(),K(),J()}));const K=async()=>{const{result:{tangentHoursDetailList:t=[],uph:l}}=await function(t,a){return e({url:"/api/services/app/WorkingHours/GetTangentHoursList",method:"get",data:{auditFlowId:t,productId:a}})}(a,g);if(!t.length){const{result:t=[]}=await function(t){return e({url:"/api/services/app/ProductionControl/GetAllYearsFrom",method:"get",data:{auditFlowId:t}})}(a);return D.tangentForm.tangent=t||[],void(D.isSaved=!1)}D.isSaved=!0,D.uph=l,D.tangentForm.tangent=t||[]},Z=async t=>{try{await t.validate((async(t,l)=>{if(t){const{success:t}=await function(t){return e({url:"/api/services/app/WorkingHours/SaveTangentHours",method:"post",data:t})}({uph:Number(D.uph||0),auditFlowId:a,productId:g,tangentHoursDetailList:D.tangentForm.tangent});if(!t)throw Error();w.success("请求成功！")}}))}catch{w.error("请填写正确表单")}};return(e,t)=>{const a=p("el-button"),l=p("el-upload"),r=p("el-row"),o=p("el-table-column"),g=p("el-table"),w=p("el-card"),f=p("el-input"),v=p("el-input-number"),P=p("el-form-item"),q=p("el-form"),_=y("havedone");return s(),i("div",$,[n(w,{class:"m-2"},{header:u((()=>[n(r,{align:"middle",justify:"space-between"},{default:u((()=>[I,n(r,{align:"middle"},{default:u((()=>[n(l,{class:"m-2",action:"/api/services/app/WorkingHours/UploadExcel","on-success":x,"show-file-list":!1,data:{auditFlowId:D.auditFlowId},"on-progress":d(k),"on-error":d(H)},{default:u((()=>[n(a,{type:"primary"},{default:u((()=>[L])),_:1})])),_:1},8,["data","on-progress","on-error"]),n(a,{class:"m-2",type:"primary",onClick:E},{default:u((()=>[N])),_:1}),n(a,{class:"m-2",type:"primary",onClick:O},{default:u((()=>[U])),_:1}),n(a,{class:"m-2",type:"primary",onClick:G},{default:u((()=>[C])),_:1}),n(a,{class:"m-2",type:"primary",onClick:Q},{default:u((()=>[V])),_:1}),n(a,{class:"m-2",type:"primary",onClick:z},{default:u((()=>[R])),_:1})])),_:1})])),_:1})])),default:u((()=>[n(w,null,{default:u((()=>[n(g,{data:D.tableData,border:"",height:"700"},{default:u((()=>[n(o,{label:"序号",prop:"sequenceNumber",width:"100"}),n(o,{label:"工序",prop:"procedure",width:"100"}),n(o,{label:"设备部分","class-name":"columnColor1"},{default:u((()=>{var e;return[(s(!0),i(m,null,c(null==(e=D.equipmentPart)?void 0:e.equipmentDetails,((e,t)=>(s(),i(m,{key:`equipmentPart-${t}`},[n(o,{prop:`equipmentPart.equipmentDetails[${t}].equipmentName`,label:`设备${t+1}`,width:"180"},null,8,["prop","label"]),n(o,{prop:`equipmentPart.equipmentDetails[${t}].status`,label:`设备${t+1}状态`,width:"180"},null,8,["prop","label"]),n(o,{prop:`equipmentPart.equipmentDetails[${t}].number`,label:`设备${t+1}数量`,width:"180"},null,8,["prop","label"]),n(o,{prop:`equipmentPart.equipmentDetails[${t}].price`,label:`设备${t+1}单价`,width:"180"},null,8,["prop","label"])],64)))),128)),n(o,{prop:"equipmentPart.total",label:"设备总价",width:"180"})]})),_:1}),n(o,{label:"追溯部分","class-name":"columnColor2"},{default:u((()=>{var e;return[(s(!0),i(m,null,c(null==(e=D.retrospectPart)?void 0:e.equipmentDetails,((e,t)=>(s(),i(m,{key:`retrospectPart-${t}`},[n(o,{prop:`retrospectPart.equipmentDetails[${t}].equipmentName`,label:`设备${t+1}`,width:"180"},null,8,["prop","label"]),n(o,{prop:`retrospectPart.equipmentDetails[${t}].status`,label:"状态",width:"180"},null,8,["prop"]),n(o,{prop:`retrospectPart.equipmentDetails[${t}].number`,label:"数量",width:"180"},null,8,["prop"]),n(o,{prop:`retrospectPart.equipmentDetails[${t}].price`,label:"单价",width:"180"},null,8,["prop"])],64)))),128)),n(o,{prop:"retrospectPart.openGraphSoftware",label:"开图软件",width:"180"}),n(o,{prop:"retrospectPart.openGraphSoftware",label:"软件",width:"180"}),n(o,{prop:"retrospectPart.openGraphFee",label:"开发费(开图)",width:"180"}),n(o,{prop:"retrospectPart.total",label:"开发总价",width:"180"})]})),_:1}),n(o,{label:"工装治具部分","class-name":"columnColor3"},{default:u((()=>{var e;return[(s(!0),i(m,null,c(null==(e=D.toolingFixturePart)?void 0:e.equipmentDetails,((e,t)=>(s(),i(m,{key:`toolingFixturePart-${t}`},[n(o,{prop:`toolingFixturePart.equipmentDetails[${t}].equipmentName`,label:`治具${t+1}`,width:"180"},null,8,["prop","label"]),n(o,{prop:`toolingFixturePart.equipmentDetails[${t}].status`,label:"状态",width:"180"},null,8,["prop"]),n(o,{prop:`toolingFixturePart.equipmentDetails[${t}].number`,label:"数量",width:"180"},null,8,["prop"]),n(o,{prop:`toolingFixturePart.equipmentDetails[${t}].price`,label:`治具单价${t+1}`,width:"180"},null,8,["prop","label"])],64)))),128)),n(o,{prop:"toolingFixturePart.toolingName",label:"工装名称",width:"180"}),n(o,{prop:"toolingFixturePart.toolingNum",label:"数量",width:"180"}),n(o,{prop:"toolingFixturePart.toolingPrice",label:"工装单价",width:"180"}),n(o,{prop:"toolingFixturePart.testName",label:"测试线名称",width:"180"}),n(o,{prop:"toolingFixturePart.testNum",label:"数量",width:"180"}),n(o,{prop:"toolingFixturePart.testPrice",label:"线束单价",width:"180"}),n(o,{prop:"toolingFixturePart.total",label:"工装治具总价",width:"180"})]})),_:1}),(s(!0),i(m,null,c(D.humanMachineHoursDetailList,((e,t)=>(s(),h(o,{key:`humanMachineHoursDetailList-${t}`,label:e.year,"class-name":"columnColor4"},{default:u((()=>[n(o,{prop:`humanMachineHoursDetailList[${t}]laborTime`,label:"标准人工工时",width:"180"},null,8,["prop"]),n(o,{prop:`humanMachineHoursDetailList[${t}]machineHours`,label:"机器工时",width:"180"},null,8,["prop"]),n(o,{prop:`humanMachineHoursDetailList[${t}]personnelNumber`,label:"人均跟线数量",width:"180"},null,8,["prop"])])),_:2},1032,["label"])))),128))])),_:1},8,["data"]),n(r,{align:"middle",justify:"end",style:{"margin-top":"20px"}},{default:u((()=>[b((s(),h(a,{type:"primary",onClick:X},{default:u((()=>[S])),_:1})),[[_]])])),_:1})])),_:1}),n(w,{style:{"margin-top":"20px"}},{header:u((()=>[n(r,{align:"middle",justify:"space-between"},{default:u((()=>[j])),_:1})])),default:u((()=>[n(r,{align:"middle",style:{width:"350px","flex-wrap":"nowrap"}},{default:u((()=>[W])),_:1}),n(f,{style:{width:"180px"},class:"m-2",modelValue:D.uph,"onUpdate:modelValue":t[0]||(t[0]=e=>D.uph=e),type:"number",placeholder:"请输入UPH值"},null,8,["modelValue"]),n(q,{model:D.tangentForm,ref_key:"tangentFormRef",ref:F},{default:u((()=>[n(g,{data:D.tangentForm.tangent,height:"500"},{default:u((()=>[n(o,{label:"年份",prop:"year"}),n(o,{label:"人工工时",prop:"`laborTime`",width:"175"},{default:u((({row:e,$index:t})=>[n(P,{prop:`tangent.${t}.laborTime`,rules:[{required:!0,message:"请输入人工工时",trigger:"change"}]},{default:u((()=>[n(v,{modelValue:e.laborTime,"onUpdate:modelValue":t=>e.laborTime=t,min:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),n(o,{label:"机器工时",prop:"machineHours",width:"175"},{default:u((({row:e,$index:t})=>[n(P,{prop:`tangent.${t}.machineHours`,rules:[{required:!0,message:"请输入机器工时",trigger:"change"}]},{default:u((()=>[n(v,{modelValue:e.machineHours,"onUpdate:modelValue":t=>e.machineHours=t,min:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),n(o,{label:"人均跟线数量",prop:"personnelNumber",width:"175"},{default:u((({row:e,$index:t})=>[n(P,{prop:`tangent.${t}.personnelNumber`,rules:[{required:!0,message:"请输入人均跟线数量",trigger:"change"}]},{default:u((()=>[n(v,{modelValue:e.personnelNumber,"onUpdate:modelValue":t=>e.personnelNumber=t,min:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1})])),_:1},8,["data"]),n(r,{align:"middle",justify:"end",style:{"margin-top":"20px"}},{default:u((()=>[b((s(),h(a,{type:"primary",onClick:t[1]||(t[1]=e=>Z(F.value))},{default:u((()=>[A])),_:1})),[[_]]),b((s(),h(a,{type:"warning",disabled:!D.isSaved,onClick:t[2]||(t[2]=e=>Y(F.value))},{default:u((()=>[M])),_:1},8,["disabled"])),[[_]])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])}}}),[["__scopeId","data-v-7cc0ff88"]]);export{T as default};
