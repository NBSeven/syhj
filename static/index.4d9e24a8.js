import{Q as e,_ as a,a as l,M as t,k as s,m as o,N as r,S as i,W as d,b as u,i as n,e as m,w as p,g as c,E as b,r as f,o as w,f as h,x as V,F as g,n as _,y,Z as v}from"./index.233133c1.js";import{a as F}from"./departmentManage.b09074ef.js";import{a as k,h as C}from"./upload.b7b7a52e.js";const U={class:"user"},x={class:"user__btn-container"},R=y("搜索"),A={class:"user__btn-container user__flex"},L=y("创建用户"),N=y("用户导入模板下载"),z=y("用户导入"),P=y("编辑"),W=y("重置密码"),E=y("删除"),S={class:"dictionary__btn-container"},I={class:"dialog-footer"},O=y("取消"),D=y("保存"),j=y("重置"),T={class:"dialog-footer"},B=y("取消"),G=y("保存");var $=a(l({__name:"index",setup(a,{expose:l}){const y=t(),$=s({tableData:[],dialogVisible:!1,psVisible:!1,psResetVisible:!1,formLabelWidth:"140px",searchForm:{keyword:""},pageNo:1,pageSize:20,maxResultCount:20,total:0,rowSelect:{},isEdit:!1,userForm:{name:"",surname:"",position:"",number:"",userName:"",emailAddress:"",isActive:!0,roleNames:[],password:"",departmentId:""},psResetForm:{adminPassword:"",newPassword:""},departmentOptions:[]}),M=async()=>{let a=null;a=$.isEdit?await function(a){return e({url:"/api/services/app/User/Update",method:"put",data:a})}($.userForm):await function(a){return e({url:"/api/services/app/User/Create",method:"post",data:a})}($.userForm),a.success&&(b({type:"success",message:"保存成功"}),$.dialogVisible=!1)},Q=()=>{$.isEdit=!1,$.userForm={name:"",surname:"",position:"",number:"",userName:"",emailAddress:"",isActive:!0,roleNames:[],password:""}},Z=(a,l)=>{v.confirm("确定删除该用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{let a=await(t=l.id,e({url:"/api/services/app/User/Delete",method:"delete",data:{id:t}}));var t;a.success&&b({type:"success",message:"删除成功"})})).catch((()=>{b({type:"info",message:"取消成功"})}))},q=()=>{K()},H=async()=>{let a=Object.assign({userId:$.rowSelect.id},$.psResetForm),l=await function(a){return e({url:"/api/services/app/User/ResetPassword",method:"post",data:a})}(a);l.success&&(b.success("重置密码成功！"),$.psVisible=!1)},J=()=>{K()},K=async()=>{let a={keyword:"",maxResultCount:20,skipCount:0};a.keyword=$.searchForm.keyword,a.skipCount=($.pageNo-1)*$.pageSize,a.maxResultCount=$.pageSize;let l=await function(a){return e({url:"/api/services/app/User/GetAll",method:"get",data:a})}(a);$.tableData=l.result.items,$.total=l.result.totalCount},X=async()=>{let a=await function(a){return e({url:"/api/services/app/Role/GetAll",method:"get",data:a})}({keyword:"",maxResultCount:100,skipCount:0});$.roleOption=a.result.items},Y=(a,l)=>{var t;a?(t=l.id,e({url:"/api/services/app/User/Activate",method:"post",data:{id:t}})):function(a){e({url:"/api/services/app/User/DeActivate",method:"post",data:{id:a}})}(l.id)},ee=e=>{e.result.isSuccess?(b({message:e.result.message,type:"success"}),K()):b({message:e.result.message,type:"error"})},ae=async()=>{const a=await e({url:"/api/services/app/User/GetImportTemplate",method:"get",responseType:"blob"}),l=new FileReader;l.readAsDataURL(a),l.onload=function(){let e=URL.createObjectURL(new Blob([a])),l=document.createElement("a");document.body.appendChild(l),l.href=e,l.download="模板文件.xlsx",l.target="_blank",l.click(),l.remove()}};return o((()=>{})),r((async()=>{K(),(await F()).result.items.forEach((e=>{$.departmentOptions.push(e)})),X()})),i((()=>{})),l({...d($)}),(e,a)=>{const l=f("el-input"),t=f("el-form-item"),s=f("el-button"),o=f("el-form"),r=f("el-upload"),i=f("el-table-column"),d=f("el-switch"),b=f("el-table"),v=f("el-pagination"),F=f("el-option"),K=f("el-select"),X=f("el-dialog");return w(),u("div",U,[n("div",x,[m(o,{model:$.searchForm,inline:""},{default:p((()=>[m(t,{label:"关键字"},{default:p((()=>[m(l,{modelValue:$.searchForm.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>$.searchForm.keyword=e)},null,8,["modelValue"])])),_:1}),m(t,null,{default:p((()=>[m(s,{type:"primary",onClick:J},{default:p((()=>[R])),_:1})])),_:1})])),_:1},8,["model"])]),n("div",A,[m(s,{type:"primary",onClick:a[1]||(a[1]=e=>$.dialogVisible=!0)},{default:p((()=>[L])),_:1}),m(s,{type:"primary",onClick:ae},{default:p((()=>[N])),_:1}),m(r,{action:"/api/services/app/User/ExcelImport","on-success":ee,"show-file-list":!1,style:{"margin-left":"20px"},name:"excle","on-progress":c(k),"on-error":c(C)},{default:p((()=>[m(s,{type:"primary"},{default:p((()=>[z])),_:1})])),_:1},8,["on-progress","on-error"])]),m(b,{data:$.tableData},{default:p((()=>[m(i,{label:"id",prop:"id"}),m(i,{label:"姓名",prop:"name"}),m(i,{label:"激活状态",prop:"isActive"},{default:p((e=>[m(d,{modelValue:e.row.isActive,"onUpdate:modelValue":a=>e.row.isActive=a,size:"large","active-text":"激活","inactive-text":"关闭",onChange:a=>Y(a,e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),m(i,{label:"角色名称",prop:"roleNames"}),m(i,{label:"操作",width:"300",fixed:"right"},{default:p((e=>[m(s,{size:"small",onClick:a=>{return e.$index,l=e.row,$.isEdit=!0,$.userForm=l,void($.dialogVisible=!0);var l}},{default:p((()=>[P])),_:2},1032,["onClick"]),m(s,{size:"small",onClick:a=>{return e.$index,l=e.row,$.rowSelect=l,void($.psResetVisible=!0);var l}},{default:p((()=>[W])),_:2},1032,["onClick"]),m(s,{size:"small",type:"danger",onClick:a=>Z(e.$index,e.row)},{default:p((()=>[E])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),n("div",S,[m(v,{background:"",layout:"prev, pager, next",total:$.total,"page-size":$.pageSize,currentPage:$.pageNo,"onUpdate:currentPage":[a[2]||(a[2]=e=>$.pageNo=e),q]},null,8,["total","page-size","currentPage"])]),m(X,{modelValue:$.dialogVisible,"onUpdate:modelValue":a[11]||(a[11]=e=>$.dialogVisible=e),title:"用户信息",onClose:Q},{footer:p((()=>[n("span",I,[m(s,{onClick:a[9]||(a[9]=e=>$.dialogVisible=!1)},{default:p((()=>[O])),_:1}),m(s,{type:"primary",onClick:M},{default:p((()=>[D])),_:1}),m(s,{onClick:a[10]||(a[10]=e=>{var a;(a=y.value)&&a.resetFields()})},{default:p((()=>[j])),_:1})])])),default:p((()=>[m(o,{model:$.userForm,ref_key:"userForm",ref:y},{default:p((()=>[m(t,{label:"名字","label-width":$.formLabelWidth},{default:p((()=>[m(l,{modelValue:$.userForm.name,"onUpdate:modelValue":a[3]||(a[3]=e=>$.userForm.name=e)},null,8,["modelValue"])])),_:1},8,["label-width"]),m(t,{label:"职位","label-width":$.formLabelWidth},{default:p((()=>[m(l,{modelValue:$.userForm.position,"onUpdate:modelValue":a[4]||(a[4]=e=>$.userForm.position=e)},null,8,["modelValue"])])),_:1},8,["label-width"]),m(t,{label:"工号","label-width":$.formLabelWidth},{default:p((()=>[m(l,{modelValue:$.userForm.number,"onUpdate:modelValue":a[5]||(a[5]=e=>$.userForm.number=e)},null,8,["modelValue"])])),_:1},8,["label-width"]),$.isEdit?V("",!0):(w(),h(t,{key:0,label:"密码","label-width":$.formLabelWidth},{default:p((()=>[m(l,{modelValue:$.userForm.password,"onUpdate:modelValue":a[6]||(a[6]=e=>$.userForm.password=e)},null,8,["modelValue"])])),_:1},8,["label-width"])),m(t,{label:"角色选择","label-width":$.formLabelWidth},{default:p((()=>[m(K,{modelValue:$.userForm.roleNames,"onUpdate:modelValue":a[7]||(a[7]=e=>$.userForm.roleNames=e),multiple:""},{default:p((()=>[(w(!0),u(g,null,_($.roleOption,(e=>(w(),h(F,{value:e.name,key:e.id,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),m(t,{label:"部门","label-width":$.formLabelWidth},{default:p((()=>[m(K,{modelValue:$.userForm.departmentId,"onUpdate:modelValue":a[8]||(a[8]=e=>$.userForm.departmentId=e)},{default:p((()=>[(w(!0),u(g,null,_($.departmentOptions,(e=>(w(),h(F,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model"])])),_:1},8,["modelValue"]),m(X,{modelValue:$.psResetVisible,"onUpdate:modelValue":a[15]||(a[15]=e=>$.psResetVisible=e),title:"重置密码"},{footer:p((()=>[n("span",T,[m(s,{onClick:a[14]||(a[14]=e=>$.psResetVisible=!1)},{default:p((()=>[B])),_:1}),m(s,{type:"primary",onClick:H},{default:p((()=>[G])),_:1})])])),default:p((()=>[m(o,{model:$.psResetForm},{default:p((()=>[m(t,{label:"管理员密码","label-width":$.formLabelWidth},{default:p((()=>[m(l,{modelValue:$.psResetForm.adminPassword,"onUpdate:modelValue":a[12]||(a[12]=e=>$.psResetForm.adminPassword=e),type:"password"},null,8,["modelValue"])])),_:1},8,["label-width"]),m(t,{label:"用户新密码","label-width":$.formLabelWidth},{default:p((()=>[m(l,{modelValue:$.psResetForm.newPassword,"onUpdate:modelValue":a[13]||(a[13]=e=>$.psResetForm.newPassword=e),type:"password"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-1ca1aca6"]]);export{$ as default};
