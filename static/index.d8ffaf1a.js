import{g as e}from"./getQuery.39609eb8.js";import{_ as l,a,M as t,k as o,V as u,l as r,N as d,W as n,b as p,e as i,w as m,r as s,o as c,I as f,f as y,F as V,n as b,i as g,g as _,y as h,t as q,u as T,j as C,E as F,X as v,z as U,A as w}from"./index.579ec607.js";import{_ as S}from"./lodash.3a81bb3a.js";import{g as N,a as O,s as D}from"./service.a1035605.js";import{g as P}from"./dictionary.cef4c10c.js";import{_ as k}from"./index.13f927c3.js";import{h as j,a as x}from"./upload.7b4109d2.js";import"./user.e7e1f9cc.js";const Y="1";const M=e=>(U("data-v-3a3dcfa2"),e=e(),w(),e),L={class:"demand-apply"},R=h("自动生成"),E=M((()=>g("h5",null,"项目走量",-1))),I=M((()=>g("h6",null,"终端走量（单位：PCS）",-1))),Q={class:"demand-apply__btn-container"},A=h("新增"),$=h(" 删除 "),J=M((()=>g("h6",null,"模组数量",-1))),z={class:"demand-apply__btn-container"},B=h("新增模组"),H=h("%"),K=h("%"),W=h("删除"),X=M((()=>g("h6",null,"要求",-1))),Z=h("%"),G=h("%"),ee=h("%"),le=M((()=>g("h6",null,"产品信息",-1))),ae=h("元"),te=h("元"),oe=h("元"),ue=h("元"),re=h("元"),de=h("元"),ne=h("元"),pe=M((()=>g("h6",null,"客户指定/供应详情",-1))),ie=h("点击生成"),me=h("SOR文件上传"),se=h("提交");var ce=l(a({__name:"index",setup(l,{expose:a}){const U=t(),w=o({projectName:[{required:!0,message:"请输入该值",trigger:"blur"}],projectCode:[{required:!0,message:"请输入该值",trigger:"blur"}],customerName:[{required:!0,message:"请输入该值",trigger:"blur"}],customerNature:[{required:!0,message:"请输入该值",trigger:"blur"}],country:[{required:!0,message:"请输入该值",trigger:"blur"}],quotationType:[{required:!0,message:"请输入该值",trigger:"blur"}],sopTime:[{required:!0,message:"请输入该值",trigger:"blur"}],projectCycle:[{required:!0,message:"请输入该值",trigger:"blur"}],allocationOfMouldCost:[{required:!0,message:"请输入该值",trigger:"blur"}],allocationOfFixtureCost:[{required:!0,message:"请输入该值",trigger:"blur"}],allocationOfEquipmentCost:[{required:!0,message:"请输入该值",trigger:"blur"}],reliabilityCost:[{required:!0,message:"请输入该值",trigger:"blur"}],developmentCost:[{required:!0,message:"请输入该值",trigger:"blur"}],landingFactory:[{required:!0,message:"请输入该值",trigger:"blur"}],tradeMode:[{required:!0,message:"请输入该值",trigger:"blur"}],salesType:[{required:!0,message:"请输入该值",trigger:"blur"}],paymentMethod:[{required:!0,message:"请输入该值",trigger:"blur"}],currency:[{required:!0,message:"请输入该值",trigger:"blur"}],customerTargetPrice:[{required:!0,message:"请输入该值",trigger:"blur"}],customerSpecialRequest:[{required:!0,message:"请输入该值",trigger:"blur"}],shippingType:[{required:!0,message:"请输入该值",trigger:"blur"}],packagingType:[{required:!0,message:"请输入该值",trigger:"blur"}],placeOfDelivery:[{required:!0,message:"请输入该值",trigger:"blur"}],deadline:[{required:!0,message:"请输入该值",trigger:"blur"}],projectManager:[{required:!0,message:"请输入该值",trigger:"blur"}],sorFile:[{required:!0,message:"请输入该值",trigger:"blur"}]}),M=e=>{const{columns:l,data:a}=e,t=[];let o=new Array(a[0].pcsYearList.length).fill(0).map((()=>[]));return a.forEach((e=>{e.pcsYearList.forEach(((e,l)=>{var a;null==(a=o[l])||a.push(Number(e.quantity))}))})),l.forEach(((e,l)=>{var a;if(0!==l)if(l>=2){let e=l-2;t[l]=null==(a=o[e])?void 0:a.reduce(((e,l)=>e+l))}else t[l]="N/A";else t[l]="合计"})),t.forEach((e=>{"number"==typeof e&&Ve.push(e)})),Ve.length>0&&(ge.carAnnualTotal=Ve.reduce(((e,l)=>e+l))),t};let ce=window.localStorage.getItem("user"),fe=ce?JSON.parse(ce):{},ye=!1,Ve=[];const be=e=>{if(Array.isArray(e.pcsYearList)&&e.pcsYearList.length>0)return e.pcsYearList.map((e=>e.quantity)).reduce(((e,l)=>Number(e)+Number(l)))},ge=o({quoteForm:{title:"",drafter:"",drafterNumber:null,draftingDepartment:"",draftingCompany:"",draftDate:new Date,number:"",projectName:"",projectCode:"",customerName:"",customerNature:"",country:"",terminalName:"",terminalNature:"",quotationType:"",sopTime:u(new Date).format("YYYY"),projectCycle:0,pcs:[],modelCount:[],requirement:[],allocationOfMouldCost:!0,allocationOfFixtureCost:!0,allocationOfEquipmentCost:!0,reliabilityCost:!0,developmentCost:!0,landingFactory:"",productInformation:[],tradeMode:"",salesType:"",paymentMethod:"",currency:"",customerTargetPrice:0,exchangeRate:0,customerSpecialRequest:"",shippingType:"",packagingType:"",placeOfDelivery:"",deadline:new Date,projectManager:void 0,sorFile:[],reason:"",auditFlowId:1},quoteVersion:"",yearCols:[],carAnnualTotal:0,sumArr:[],customerNatureOptions:[],terminalNatureOptions:[],quotationTypeOptions:[],sampleQuotationTypeOptions:[],countryOptions:[],productOptions:[],productTypeOptions:[],allocationOfMouldCostOptions:[],allocationOfFixtureCostOptions:[],allocationOfEquipmentCostOptions:[],reliabilityCostOptions:[],developmentCostOptions:[],landingFactoryOptions:[],salesTypeOptions:[],currencyOptions:[],shippingTypeOptions:[],packagingTypeOptions:[],TypeSelectOptions:[],TradeMethodOptions:[],ExchangeSelectOptions:[]}),_e=t([]),he=t(0);let qe=T(),Te=C();let Ce=t([{carFactory:"",carModel:"",pcsYearList:[],sum:0}]),Fe=t([{partNumber:"",product:"",productType:0,marketShare:0,moduleCarryingRate:0,singleCarProductsQuantity:0,modelTotal:0,modelCountYearList:[]}]),ve=t([]),Ue=t([{name:"",sensor:"",sensorTypeSelect:"1",sensorPrice:0,lens:"",lensTypeSelect:"1",lensPrice:0,isp:"",ispTypeSelect:"1",ispPrice:0,serialChip:"",serialChipTypeSelect:"1",serialChipPrice:0,cable:"",cableTypeSelect:"1",cablePrice:0,led:"",ledTypeSelect:"1",ledPrice:0,manufactureProcess:"",installationPosition:"",product:""}]),we=t([]);const Se=()=>{Ce.value.push(S.cloneDeep(Ce.value[0]))},Ne=()=>{Ue.value.push(Object.assign(S.cloneDeep(Ue.value[0]),{name:"",sensor:"",sensorTypeSelect:"1",sensorPrice:0,lens:"",lensTypeSelect:"1",lensPrice:0,isp:"",ispTypeSelect:"1",ispPrice:0,serialChip:"",serialChipTypeSelect:"1",serialChipPrice:0,cable:"",cableTypeSelect:"1",cablePrice:0,led:"",ledTypeSelect:"1",ledPrice:0,manufactureProcess:"",installationPosition:""}));let e=Object.assign(S.cloneDeep(Fe.value[0]),{partNumber:"",product:"",productType:0,marketShare:0,moduleCarryingRate:0,singleCarProductsQuantity:0,modelTotal:0});e.modelCountYearList.forEach((e=>{e.quantity=""})),Fe.value.push(e),Ue.value.forEach(((e,l)=>{e.name=Fe[l].product,e.product=Fe[l].product}))},Oe=e=>{if(e){he.value=e;let l=ge.quoteForm.projectCycle;ge.yearCols=[],ge.quoteForm.sopTime;for(let e=0;e<l;e++)ge.yearCols.push(Number(ge.quoteForm.sopTime)+e)}};r((()=>ge.yearCols),(e=>{ye||(Ce.value.forEach((l=>{l.pcsYearList=e.map((e=>({year:e,quantity:null})))})),Fe.value.forEach((l=>{l.modelCountYearList=e.map((e=>({year:e,quantity:null})))})),ve.value.splice(0,ve.value.length),e.forEach((e=>{ve.value.push({year:e,annualDeclineRate:0,annualRebateRequirements:0,oneTimeDiscountRate:0})})))})),r(Fe,(e=>{e.forEach(((e,l)=>{Ue.value[l].name=e.product,Ue.value[l].product=e.product,Fe.value.forEach((e=>{e.modelCountYearList.forEach(((l,a)=>{e.marketShare&&e.moduleCarryingRate&&e.singleCarProductsQuantity&&Ve[a]&&(l.quantity=e.marketShare*e.moduleCarryingRate*e.singleCarProductsQuantity*Ve[a]/1e4)}))})),e.marketShare&&e.moduleCarryingRate&&e.singleCarProductsQuantity&&ge.carAnnualTotal&&(e.modelTotal=e.marketShare*e.moduleCarryingRate*e.singleCarProductsQuantity*ge.carAnnualTotal/1e4)}))}),{deep:!0});const De=e=>{},Pe=(e,l)=>{},ke=()=>{let{quoteForm:e}=ge,l=`${u(e.draftDate?e.draftDate:new Date).format("YYYY-MM-DD")+e.draftingDepartment}关于${e.customerName+e.projectName+"第"+ge.quoteVersion+"版"}的核价报价申请`;ge.quoteForm.title=l},je=()=>{we.value.splice(0,we.value.length),Ue.value.forEach((e=>{if(e.sensorTypeSelect!==Y){let l=e.sensorPrice,a=e.name,t="sensor",o=e.sensor,u="2"===e.sensorTypeSelect?"客户指定":"客户供应";we.value.push({price:l,productName:a,main:t,type:o,productType:u})}if(e.lensTypeSelect!==Y){let l=e.lensPrice,a=e.name,t="lens",o=e.lens,u="2"===e.lensTypeSelect?"客户指定":"客户供应";we.value.push({price:l,productName:a,main:t,type:o,productType:u})}if(e.ispTypeSelect!==Y){let l=e.ispPrice,a=e.name,t="isp",o=e.isp,u="2"===e.ispTypeSelect?"客户指定":"客户供应";we.value.push({price:l,productName:a,main:t,type:o,productType:u})}if(e.serialChipTypeSelect!==Y){let l=e.serialChipPrice,a=e.name,t="serialChip",o=e.serialChip,u="2"===e.serialChipTypeSelect?"客户指定":"客户供应";we.value.push({price:l,productName:a,main:t,type:o,productType:u})}if(e.ledTypeSelect!==Y){let l=e.ledPrice,a=e.name,t="led",o=e.led,u="2"===e.ledTypeSelect?"客户指定":"客户供应";we.value.push({price:l,productName:a,main:t,type:o,productType:u})}}))},xe=e=>{ge.ExchangeSelectOptions.forEach((l=>{l.id===e&&l.exchangeRateValue.forEach((e=>{e.year===Number(ge.quoteForm.sopTime)&&(ge.quoteForm.exchangeRate=e.value)}))}))};return d((async()=>{var l,a;let t=e();ge.quoteForm.projectName=t.projectName?t.projectName+"":"",ge.quoteForm.projectCode=t.projectCode?t.projectCode+"":"",ge.quoteVersion=t.quoteVersion?t.quoteVersion+"":"",ge.quoteForm.drafter=fe.name,ge.quoteForm.drafterNumber=fe.userNumber||"未成功获取",ge.quoteForm.draftingCompany=(null==(l=fe.userCompany)?void 0:l.name)||"未成功获取",ge.quoteForm.draftingDepartment=(null==(a=fe.userDepartment)?void 0:a.name)||"未成功获取",(()=>{let{quoteForm:e}=ge,l="BJHJ-ZL"+u(e.draftDate?e.draftDate:new Date).format("YYYYMMDD")+"-001";e.number=l})();try{let e=await P("CustomerNature");ge.customerNatureOptions=e.result.financeDictionaryDetailList;let l=await P("TerminalNature");ge.terminalNatureOptions=l.result.financeDictionaryDetailList;let a=await P("QuotationType");ge.quotationTypeOptions=a.result.financeDictionaryDetailList;let t=await P("Country");ge.countryOptions=t.result.financeDictionaryDetailList;let o=await P("ProductType");ge.productTypeOptions=o.result.financeDictionaryDetailList;let u=await P("LandingFactory");ge.landingFactoryOptions=u.result.financeDictionaryDetailList;let r=await P("SalesType");ge.salesTypeOptions=r.result.financeDictionaryDetailList;let d=await P("Currency");ge.currencyOptions=d.result.financeDictionaryDetailList;let n=await P("ShippingType");ge.shippingTypeOptions=n.result.financeDictionaryDetailList;let p=await P("PackagingType");ge.packagingTypeOptions=p.result.financeDictionaryDetailList;let i=await P("TypeSelect");ge.TypeSelectOptions=i.result.financeDictionaryDetailList;let m=await P("TradeMethod");ge.TradeMethodOptions=m.result.financeDictionaryDetailList;let s=await N({maxResultCount:100,skipCount:0});ge.ExchangeSelectOptions=s.result.items}catch(o){}if(t.auditFlowId){let e=await O(t.auditFlowId);if(e.result){ye=!0,ge.quoteForm=e.result;const l=[e.result.sopTime];ge.quoteForm.sopTime=u(l).format("YYYY"),Ce.value=e.result.pcs,Oe(e.result.projectCycle),Ue.value=e.result.productInformation,Fe.value=e.result.modelCount,ve.value=e.result.requirement}setTimeout((()=>{ye=!1}),2e3)}})),a({...n(ge)}),(e,l)=>{const a=s("el-button"),t=s("el-input"),o=s("el-form-item"),u=s("el-col"),r=s("el-date-picker"),d=s("el-row"),n=s("el-card"),T=s("el-option"),C=s("el-select"),S=s("el-input-number"),N=s("el-table-column"),O=s("el-table"),P=s("el-upload"),Y=s("el-form"),ce=v("havedone");return c(),p("div",L,[i(Y,{model:ge.quoteForm,ref_key:"refForm",ref:U,rules:w},{default:m((()=>[i(n,{class:"demand-apply__card"},{default:m((()=>[i(d,{gutter:20},{default:m((()=>[i(u,{span:24},{default:m((()=>[i(o,{label:"标题:",prop:"title"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.title,"onUpdate:modelValue":l[0]||(l[0]=e=>ge.quoteForm.title=e)},{append:m((()=>[f((c(),y(a,{onClick:ke},{default:m((()=>[R])),_:1})),[[ce]])])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"拟稿人:",prop:"drafter"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.drafter,"onUpdate:modelValue":l[1]||(l[1]=e=>ge.quoteForm.drafter=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"拟稿人工号:",prop:"drafterNumber"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.drafterNumber,"onUpdate:modelValue":l[2]||(l[2]=e=>ge.quoteForm.drafterNumber=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"拟稿公司:",prop:"draftingCompany"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.draftingCompany,"onUpdate:modelValue":l[3]||(l[3]=e=>ge.quoteForm.draftingCompany=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"拟稿部门:",prop:"draftingDepartment"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.draftingDepartment,"onUpdate:modelValue":l[4]||(l[4]=e=>ge.quoteForm.draftingDepartment=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"拟稿日期:",prop:"draftDate"},{default:m((()=>[i(r,{modelValue:ge.quoteForm.draftDate,"onUpdate:modelValue":l[5]||(l[5]=e=>ge.quoteForm.draftDate=e),onChange:ke,disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"单据编号:",prop:"number"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.number,"onUpdate:modelValue":l[6]||(l[6]=e=>ge.quoteForm.number=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),i(n,{class:"demand-apply__card"},{default:m((()=>[i(d,{gutter:20},{default:m((()=>[i(u,{span:8},{default:m((()=>[i(o,{label:"项目名称:",prop:"projectName"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.projectName,"onUpdate:modelValue":l[7]||(l[7]=e=>ge.quoteForm.projectName=e),placeholder:"与PLM系统保持一致",onChange:ke},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:8},{default:m((()=>[i(o,{label:"项目代码:",prop:"projectCode"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.projectCode,"onUpdate:modelValue":l[8]||(l[8]=e=>ge.quoteForm.projectCode=e),placeholder:"与PLM系统保持一致"},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:8},{default:m((()=>[i(o,{label:"项目版本号:"},{default:m((()=>[i(t,{modelValue:ge.quoteVersion,"onUpdate:modelValue":l[9]||(l[9]=e=>ge.quoteVersion=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"客户名称:",prop:"customerName"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.customerName,"onUpdate:modelValue":l[10]||(l[10]=e=>ge.quoteForm.customerName=e),onChange:ke},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"客户性质:",prop:"customerNature"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.customerNature,"onUpdate:modelValue":l[11]||(l[11]=e=>ge.quoteForm.customerNature=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.customerNatureOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"终端名称:",prop:"terminalName"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.terminalName,"onUpdate:modelValue":l[12]||(l[12]=e=>ge.quoteForm.terminalName=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"终端性质:",prop:"terminalNature"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.terminalNature,"onUpdate:modelValue":l[13]||(l[13]=e=>ge.quoteForm.terminalNature=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.terminalNatureOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),i(d,{gutter:20},{default:m((()=>[i(u,{span:6},{default:m((()=>[i(o,{label:"报价形式:",prop:"quotationType"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.quotationType,"onUpdate:modelValue":l[14]||(l[14]=e=>ge.quoteForm.quotationType=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.quotationTypeOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"sop时间:",prop:"sopTime"},{default:m((()=>[i(r,{type:"year",placeholder:"Pick a year",modelValue:ge.quoteForm.sopTime,"onUpdate:modelValue":l[15]||(l[15]=e=>ge.quoteForm.sopTime=e),"value-format":"YYYY"},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"项目周期:",prop:"projectCycle"},{default:m((()=>[i(S,{modelValue:ge.quoteForm.projectCycle,"onUpdate:modelValue":l[16]||(l[16]=e=>ge.quoteForm.projectCycle=e),onChange:Oe,min:0},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),E,I,g("div",Q,[f((c(),y(a,{type:"primary",class:"demand-apply__add-btn",onClick:Se},{default:m((()=>[A])),_:1})),[[ce]])]),i(O,{data:_(Ce),border:"","summary-method":M,"show-summary":""},{default:m((()=>[i(N,{label:"车厂",width:"180",fixed:"left"},{default:m((({row:e})=>[i(t,{modelValue:e.carFactory,"onUpdate:modelValue":l=>e.carFactory=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"车型",width:"180",fixed:"left"},{default:m((({row:e})=>[i(t,{modelValue:e.carModel,"onUpdate:modelValue":l=>e.carModel=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(c(!0),p(V,null,b(ge.yearCols,((e,l)=>(c(),y(N,{label:e+"",key:e+"",width:"100"},{default:m((({row:e})=>[i(t,{modelValue:e.pcsYearList[l].quantity,"onUpdate:modelValue":a=>e.pcsYearList[l].quantity=a,onChange:l=>(e=>{let l=0;e.pcsYearList.forEach((e=>{l+=Number(e.quantity)})),e.rowSum=l})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1032,["label"])))),128)),i(N,{prop:"rowSum",label:"合计"},{default:m((({row:e})=>[h(q(be(e)),1)])),_:1}),i(N,{label:"操作",fixed:"right"},{default:m((({$index:e})=>[f((c(),y(a,{onClick:l=>{return a=e,void Ce.value.splice(a,1);var a},type:"danger",disabled:1===_(Ce).length},{default:m((()=>[$])),_:2},1032,["onClick","disabled"])),[[ce]])])),_:1})])),_:1},8,["data"]),J,g("div",z,[f((c(),y(a,{type:"primary",class:"demand-apply__add-btn",onClick:Ne},{default:m((()=>[B])),_:1})),[[ce]])]),i(O,{data:_(Fe),style:{width:"100%"},border:""},{default:m((()=>[i(N,{type:"index",width:"50"}),i(N,{label:"客户零件号",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.partNumber,"onUpdate:modelValue":l=>e.partNumber=l,placeholder:"若没有，填写 /"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"产品名称",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.product,"onUpdate:modelValue":l=>e.product=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"产品小类",width:"180"},{default:m((({row:e})=>[i(C,{modelValue:e.productType,"onUpdate:modelValue":l=>e.productType=l,placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.productTypeOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"市场份额",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.marketShare,"onUpdate:modelValue":l=>e.marketShare=l},{append:m((()=>[H])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"模组搭载率",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.moduleCarryingRate,"onUpdate:modelValue":l=>e.moduleCarryingRate=l},{append:m((()=>[K])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"单车产品数量",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.singleCarProductsQuantity,"onUpdate:modelValue":l=>e.singleCarProductsQuantity=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(c(!0),p(V,null,b(ge.yearCols,((e,l)=>(c(),y(N,{label:e+"",key:e+"",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.modelCountYearList[l].quantity,"onUpdate:modelValue":a=>e.modelCountYearList[l].quantity=a,onInput:e=>{}},null,8,["modelValue","onUpdate:modelValue","onInput"])])),_:2},1032,["label"])))),128)),i(N,{label:"模组总量",prop:"modelTotal",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.modelTotal,"onUpdate:modelValue":l=>e.modelTotal=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"操作",fixed:"right"},{default:m((({$index:e})=>[f((c(),y(a,{onClick:l=>{return a=e,Fe.value.splice(a,1),void Ue.value.splice(a,1);var a},type:"danger",disabled:1===_(Fe).length},{default:m((()=>[W])),_:2},1032,["onClick","disabled"])),[[ce]])])),_:1})])),_:1},8,["data"]),X,i(O,{data:_(ve),style:{width:"100%",margin:"20px 0"},border:""},{default:m((()=>[i(N,{label:"年份",width:"180",prop:"year"}),i(N,{label:"客户年降率(%)"},{default:m((({row:e})=>[i(t,{modelValue:e.annualDeclineRate,"onUpdate:modelValue":l=>e.annualDeclineRate=l},{append:m((()=>[Z])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"年度返利要求(%)"},{default:m((({row:e})=>[i(t,{modelValue:e.annualRebateRequirements,"onUpdate:modelValue":l=>e.annualRebateRequirements=l},{append:m((()=>[G])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"一次性折让率(%)"},{default:m((({row:e})=>[i(t,{modelValue:e.oneTimeDiscountRate,"onUpdate:modelValue":l=>e.oneTimeDiscountRate=l},{append:m((()=>[ee])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),i(d,{gutter:20},{default:m((()=>[i(u,{span:6},{default:m((()=>[i(o,{label:"模具费分摊:",prop:"allocationOfMouldCost"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.allocationOfMouldCost,"onUpdate:modelValue":l[17]||(l[17]=e=>ge.quoteForm.allocationOfMouldCost=e),placeholder:"Select"},{default:m((()=>[i(T,{value:!0,label:"是"}),i(T,{value:!1,label:"否"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"治具费分摊:",prop:"allocationOfFixtureCost"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.allocationOfFixtureCost,"onUpdate:modelValue":l[18]||(l[18]=e=>ge.quoteForm.allocationOfFixtureCost=e),placeholder:"Select"},{default:m((()=>[i(T,{value:!0,label:"是"}),i(T,{value:!1,label:"否"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"设备费分摊:",prop:"allocationOfEquipmentCost"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.allocationOfEquipmentCost,"onUpdate:modelValue":l[19]||(l[19]=e=>ge.quoteForm.allocationOfEquipmentCost=e),placeholder:"Select"},{default:m((()=>[i(T,{value:!0,label:"是"}),i(T,{value:!1,label:"否"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"信赖性费用分摊:",prop:"reliabilityCost"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.reliabilityCost,"onUpdate:modelValue":l[20]||(l[20]=e=>ge.quoteForm.reliabilityCost=e),placeholder:"Select"},{default:m((()=>[i(T,{value:!0,label:"是"}),i(T,{value:!1,label:"否"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"开发费分摊:",prop:"developmentCost"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.developmentCost,"onUpdate:modelValue":l[21]||(l[21]=e=>ge.quoteForm.developmentCost=e),placeholder:"Select"},{default:m((()=>[i(T,{value:!0,label:"是"}),i(T,{value:!1,label:"否"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"落地工厂:",prop:"landingFactory"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.landingFactory,"onUpdate:modelValue":l[22]||(l[22]=e=>ge.quoteForm.landingFactory=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.landingFactoryOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),i(n,{class:"demand-apply__card"},{default:m((()=>[le,i(O,{data:_(Ue),style:{width:"100%"},border:""},{default:m((()=>[i(N,{label:"产品名称",width:"180",fixed:"left"},{default:m((({row:e})=>[i(t,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"目标价",width:"180",fixed:"left"},{default:m((({row:e})=>[i(t,{modelValue:e.customerTargetPrice,"onUpdate:modelValue":l=>e.customerTargetPrice=l},{append:m((()=>[ae])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"Sensor",width:"400"},{default:m((({row:e})=>[i(t,{modelValue:e.sensor,"onUpdate:modelValue":l=>e.sensor=l,placeholder:"品牌/型号"},{prepend:m((()=>[i(C,{modelValue:e.sensorTypeSelect,"onUpdate:modelValue":l=>e.sensorTypeSelect=l},{default:m((()=>[i(T,{label:"我司推荐",value:"1"}),i(T,{label:"客户指定",value:"2"}),i(T,{label:"客户供应",value:"3"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),append:m((()=>[i(t,{modelValue:e.sensorPrice,"onUpdate:modelValue":l=>e.sensorPrice=l,placeholder:"单价"},{append:m((()=>[te])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"Lens",width:"400"},{default:m((({row:e})=>[i(t,{modelValue:e.lens,"onUpdate:modelValue":l=>e.lens=l,placeholder:"品牌/型号"},{prepend:m((()=>[i(C,{modelValue:e.lensTypeSelect,"onUpdate:modelValue":l=>e.lensTypeSelect=l},{default:m((()=>[i(T,{label:"我司推荐",value:"1"}),i(T,{label:"客户指定",value:"2"}),i(T,{label:"客户供应",value:"3"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),append:m((()=>[i(t,{modelValue:e.lensPrice,"onUpdate:modelValue":l=>e.lensPrice=l,placeholder:"单价"},{append:m((()=>[oe])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"ISP",width:"400"},{default:m((({row:e})=>[i(t,{modelValue:e.isp,"onUpdate:modelValue":l=>e.isp=l,placeholder:"品牌/型号"},{prepend:m((()=>[i(C,{modelValue:e.ispTypeSelect,"onUpdate:modelValue":l=>e.ispTypeSelect=l},{default:m((()=>[i(T,{label:"我司推荐",value:"1"}),i(T,{label:"客户指定",value:"2"}),i(T,{label:"客户供应",value:"3"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),append:m((()=>[i(t,{modelValue:e.ispPrice,"onUpdate:modelValue":l=>e.ispPrice=l,placeholder:"单价"},{append:m((()=>[ue])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"串行芯片",width:"400"},{default:m((({row:e})=>[i(t,{modelValue:e.serialChip,"onUpdate:modelValue":l=>e.serialChip=l,placeholder:"品牌/型号"},{prepend:m((()=>[i(C,{modelValue:e.serialChipTypeSelect,"onUpdate:modelValue":l=>e.serialChipTypeSelect=l},{default:m((()=>[i(T,{label:"我司推荐",value:"1"}),i(T,{label:"客户指定",value:"2"}),i(T,{label:"客户供应",value:"3"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),append:m((()=>[i(t,{modelValue:e.serialChipPrice,"onUpdate:modelValue":l=>e.serialChipPrice=l,placeholder:"单价"},{append:m((()=>[re])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"线缆",width:"400"},{default:m((({row:e})=>[i(t,{modelValue:e.cable,"onUpdate:modelValue":l=>e.cable=l,placeholder:"品牌/型号"},{prepend:m((()=>[i(C,{modelValue:e.cableTypeSelect,"onUpdate:modelValue":l=>e.cableTypeSelect=l},{default:m((()=>[i(T,{label:"我司推荐",value:"1"}),i(T,{label:"客户指定",value:"2"}),i(T,{label:"客户供应",value:"3"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),append:m((()=>[i(t,{modelValue:e.cablePrice,"onUpdate:modelValue":l=>e.cablePrice=l,placeholder:"单价"},{append:m((()=>[de])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"LED",width:"400"},{default:m((({row:e})=>[i(t,{modelValue:e.led,"onUpdate:modelValue":l=>e.led=l,placeholder:"品牌/型号"},{prepend:m((()=>[i(C,{modelValue:e.ledTypeSelect,"onUpdate:modelValue":l=>e.ledTypeSelect=l},{default:m((()=>[i(T,{label:"我司推荐",value:"1"}),i(T,{label:"客户指定",value:"2"}),i(T,{label:"客户供应",value:"3"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),append:m((()=>[i(t,{modelValue:e.ledPrice,"onUpdate:modelValue":l=>e.ledPrice=l,placeholder:"单价"},{append:m((()=>[ne])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"制程",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.manufactureProcess,"onUpdate:modelValue":l=>e.manufactureProcess=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),i(N,{label:"安装位置",width:"180"},{default:m((({row:e})=>[i(t,{modelValue:e.installationPosition,"onUpdate:modelValue":l=>e.installationPosition=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),pe,i(a,{onClick:je,type:"primary",style:{margin:"20px 0"}},{default:m((()=>[ie])),_:1}),i(O,{data:_(we),style:{width:"100%"},border:""},{default:m((()=>[i(N,{prop:"productType",label:"类型"}),i(N,{prop:"productName",label:"产品名称"}),i(N,{prop:"main",label:"核心部件"}),i(N,{prop:"type",label:"品牌/型号"}),i(N,{prop:"price",label:"单价"})])),_:1},8,["data"])])),_:1}),i(n,{class:"demand-apply__card"},{default:m((()=>[i(d,{gutter:20},{default:m((()=>[i(u,{span:6},{default:m((()=>[i(o,{label:"贸易方式:",prop:"tradeMode"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.tradeMode,"onUpdate:modelValue":l[23]||(l[23]=e=>ge.quoteForm.tradeMode=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.TradeMethodOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"销售类型:",prop:"salesType"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.salesType,"onUpdate:modelValue":l[24]||(l[24]=e=>ge.quoteForm.salesType=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.salesTypeOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"付款方式:",prop:"paymentMethod"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.paymentMethod,"onUpdate:modelValue":l[25]||(l[25]=e=>ge.quoteForm.paymentMethod=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"报价币种:",prop:"currency"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.currency,"onUpdate:modelValue":l[26]||(l[26]=e=>ge.quoteForm.currency=e),placeholder:"Select",onChange:xe},{default:m((()=>[(c(!0),p(V,null,b(ge.ExchangeSelectOptions,(e=>(c(),y(T,{key:e.id,label:e.exchangeRateKind,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"客户目标价（整套）:",prop:"customerTargetPrice"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.customerTargetPrice,"onUpdate:modelValue":l[27]||(l[27]=e=>ge.quoteForm.customerTargetPrice=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"汇率:",prop:"exchangeRate"},{default:m((()=>[i(t,{modelValue:ge.quoteForm.exchangeRate,"onUpdate:modelValue":l[28]||(l[28]=e=>ge.quoteForm.exchangeRate=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:12},{default:m((()=>[i(o,{label:"客户特殊性要求:",prop:"customerSpecialRequest"},{default:m((()=>[i(t,{type:"textarea",rows:10,modelValue:ge.quoteForm.customerSpecialRequest,"onUpdate:modelValue":l[29]||(l[29]=e=>ge.quoteForm.customerSpecialRequest=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),i(n,{class:"demand-apply__card"},{default:m((()=>[i(d,{gutter:20},{default:m((()=>[i(u,{span:6},{default:m((()=>[i(o,{label:"运输方式:",prop:"shippingType"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.shippingType,"onUpdate:modelValue":l[30]||(l[30]=e=>ge.quoteForm.shippingType=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.shippingTypeOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"包装方式:",prop:"packagingType"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.packagingType,"onUpdate:modelValue":l[31]||(l[31]=e=>ge.quoteForm.packagingType=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.packagingTypeOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"核价要求完成时间:",prop:"deadline"},{default:m((()=>[i(r,{type:"date",placeholder:"Pick a day",modelValue:ge.quoteForm.deadline,"onUpdate:modelValue":l[32]||(l[32]=e=>ge.quoteForm.deadline=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"项目经理:",prop:"projectManager"},{default:m((()=>[i(_(k),{modelValue:ge.quoteForm.projectManager,"onUpdate:modelValue":l[33]||(l[33]=e=>ge.quoteForm.projectManager=e),roleName:"项目经理"},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,{label:"出口国家:",prop:"country"},{default:m((()=>[i(C,{modelValue:ge.quoteForm.country,"onUpdate:modelValue":l[34]||(l[34]=e=>ge.quoteForm.country=e),placeholder:"Select"},{default:m((()=>[(c(!0),p(V,null,b(ge.countryOptions,(e=>(c(),y(T,{key:e.id,label:e.displayName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(u,{span:8},{default:m((()=>[i(o,{label:"交货地点:",prop:"placeOfDelivery"},{default:m((()=>[i(t,{type:"textarea",rows:10,modelValue:ge.quoteForm.placeOfDelivery,"onUpdate:modelValue":l[35]||(l[35]=e=>ge.quoteForm.placeOfDelivery=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:8},{default:m((()=>[i(o,{label:"核价原因:",prop:"reason"},{default:m((()=>[i(t,{type:"textarea",rows:10,modelValue:ge.quoteForm.reason,"onUpdate:modelValue":l[36]||(l[36]=e=>ge.quoteForm.reason=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(u,{span:6},{default:m((()=>[i(o,null,{default:m((()=>[i(P,{"file-list":_e.value,"onUpdate:file-list":l[37]||(l[37]=e=>_e.value=e),action:"/api/services/app/FileCommonService/UploadFile","on-success":De,"on-error":_(j),"on-change":Pe,multiple:"","on-progress":_(x)},{default:m((()=>[i(a,null,{default:m((()=>[me])),_:1})])),_:1},8,["file-list","on-error","on-progress"])])),_:1})])),_:1})])),_:1}),f((c(),y(a,{type:"primary",size:"large",style:{float:"right",margin:"20px 0"},onClick:l[38]||(l[38]=e=>(async e=>{let{auditFlowId:l}=qe.query;e&&await e.validate((async(e,a)=>{if(e){let{quoteForm:e}=ge;e.auditFlowId=l?Number(l):5,e.pcs=Ce,e.modelCount=Fe,e.requirement=ve,e.productInformation=Ue,e.sorFile=_e.value.map((e=>e.response.result.fileId)),(await D(e)).success&&(F({type:"success",message:"保存成功"}),Te.push({path:"/todoCenter/index"}))}else ge.quoteForm}))})(U.value))},{default:m((()=>[se])),_:1})),[[ce]])])),_:1})])),_:1},8,["model","rules"])])}}}),[["__scopeId","data-v-3a3dcfa2"]]);export{ce as default};
